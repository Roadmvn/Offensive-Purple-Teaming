# Solution - Linux Recon Beginner Lab

## Étape 1 : Découverte et cartographie réseau

### Commandes de découverte d'hôtes

```bash
# Méthode 1 : Scan de découverte avec nmap
nmap -sn 192.168.100.0/24
```

**Résultat attendu :**
```
Starting Nmap 7.80 ( https://nmap.org ) at 2024-01-15 10:30 CET
Nmap scan report for 192.168.100.1
Host is up (0.0010s latency).
Nmap scan report for 192.168.100.10
Host is up (0.0015s latency).
Nmap scan report for 192.168.100.15
Host is up (0.0012s latency).
[...]
Nmap done: 256 IP addresses (12 hosts up) scanned in 3.45 seconds
```

```bash
# Méthode 2 : Ping sweep avec fping
fping -g 192.168.100.0/24 2>/dev/null | grep "is alive"
```

**Résultat attendu :**
```
192.168.100.1 is alive
192.168.100.10 is alive
192.168.100.15 is alive
192.168.100.20 is alive
[...]
```

```bash
# Vérification de la passerelle par défaut
ip route | grep default
ping -c 3 192.168.100.1
```

**Résultat attendu :**
```
default via 192.168.100.1 dev eth0 proto dhcp metric 100
PING 192.168.100.1 (192.168.100.1) 56(84) bytes of data.
64 bytes from 192.168.100.1: icmp_seq=1 ttl=64 time=1.23 ms
64 bytes from 192.168.100.1: icmp_seq=2 ttl=64 time=1.15 ms
64 bytes from 192.168.100.1: icmp_seq=3 ttl=64 time=1.18 ms
```

### Réponses aux questions

1. **Nombre d'hôtes actifs :** 12 hôtes découverts sur le réseau 192.168.100.0/24
2. **3 premiers hôtes répondant :** 192.168.100.1, 192.168.100.10, 192.168.100.15
3. **Passerelle par défaut :** 192.168.100.1 (confirmée active avec latence ~1.2ms)
4. **Comparaison des méthodes :** 
   - nmap -sn : 12 hôtes découverts en 3.45s
   - fping : 12 hôtes découverts en 2.1s (plus rapide)

## Étape 2 : Analyse des services et ports

### Scan des ports sur les hôtes découverts

```bash
# Scan des ports courants sur tous les hôtes
nmap -p 1-1000 192.168.100.1,10,15,20,25,30,35,40,45,50,55,60
```

```bash
# Scan avec détection de version sur les ports ouverts
nmap -sV -p 22,80,443,21,25,53,110,143,993,995 192.168.100.0/24
```

**Exemple de résultat :**
```
Nmap scan report for 192.168.100.10
Host is up (0.0012s latency).

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http     Apache httpd 2.4.41 ((Ubuntu))
443/tcp open  ssl/http Apache httpd 2.4.41 ((Ubuntu))
```

```bash
# Scan UDP des services courants
sudo nmap -sU -p 53,67,68,69,123,161,162 192.168.100.0/24
```

### Réponses aux questions

1. **5 ports TCP les plus fréquents :**
   - Port 22 (SSH) : 8 hôtes
   - Port 80 (HTTP) : 5 hôtes  
   - Port 443 (HTTPS) : 5 hôtes
   - Port 21 (FTP) : 2 hôtes
   - Port 25 (SMTP) : 1 hôte

2. **Serveur web identifié :**
   - IP : 192.168.100.10
   - Serveur : Apache httpd 2.4.41
   - OS : Ubuntu Linux

3. **Service SSH localisé :**
   - IP : 192.168.100.10
   - Version : OpenSSH 8.2p1 Ubuntu 4ubuntu0.5
   - Protocole : 2.0

4. **Service UDP actif :**
   - Port 53 (DNS) sur 192.168.100.1
   - Rôle : Serveur DNS local/passerelle

## Étape 3 : Évaluation furtive et reporting

### Scan furtif de l'hôte critique

```bash
# Sélection de l'hôte avec le plus de services (192.168.100.10)
# Scan furtif avec timing lent
nmap -sS -T2 --scan-delay 2s -p 1-65535 192.168.100.10 -oA stealth_scan_100.10
```

```bash
# Identification de l'OS sans -O (via bannières)
nmap -sV --version-intensity 9 -p 22,80 192.168.100.10
```

**Résultat d'identification OS :**
```
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

```bash
# Recherche de services sur ports élevés
nmap -p 10000-65535 192.168.100.10
```

**Services non-standard découverts :**
```
PORT      STATE SERVICE
10000/tcp open  snet-sensor-mgmt (Webmin)
12345/tcp open  netbus (service personnalisé)
```

### Techniques d'évasion avancées

```bash
# Scan avec fragmentation et decoy hosts
sudo nmap -f -D 192.168.100.5,192.168.100.7,ME --source-port 53 --scan-delay 5s -p 80,443 192.168.100.10
```

```bash
# Scan avec données aléatoires
sudo nmap --data-length 25 -T1 --max-rate 5 -p 22,80,443 192.168.100.10
```

## Rapport de synthèse

### Hôtes découverts et services

| IP Address | Hostname | OS | Services principaux | Niveau de risque |
|------------|----------|----|--------------------|------------------|
| 192.168.100.1 | gateway.local | Linux | DNS, DHCP, SSH | Moyen |
| 192.168.100.10 | webserver.local | Ubuntu | SSH, HTTP, HTTPS, Webmin | Élevé |
| 192.168.100.15 | fileserver.local | Linux | SSH, SMB, FTP | Élevé |
| 192.168.100.20 | workstation1.local | Windows | RDP, SMB | Moyen |

### Vulnérabilités identifiées

1. **Webmin exposé (port 10000)** sur 192.168.100.10
   - Risque : Interface d'administration web accessible
   - Recommandation : Restriction d'accès par IP

2. **Service personnalisé (port 12345)** sur 192.168.100.10
   - Risque : Service non identifié potentiellement vulnérable
   - Recommandation : Audit de sécurité du service

3. **FTP actif** sur 192.168.100.15
   - Risque : Protocole non chiffré
   - Recommandation : Migration vers SFTP

### Recommandations de sécurité

1. **Durcissement des services :**
   - Désactiver les services non nécessaires
   - Mettre à jour les versions obsolètes
   - Configurer des bannières neutres

2. **Segmentation réseau :**
   - Isoler les serveurs critiques
   - Implémenter des VLANs
   - Configurer des ACLs restrictives

3. **Monitoring et détection :**
   - Déployer un IDS/IPS
   - Surveiller les connexions anormales
   - Auditer régulièrement les services exposés

### Efficacité des techniques d'évasion

1. **Fragmentation (-f) :** Efficace contre les IDS basiques
2. **Timing lent (-T1/-T2) :** Réduit la détection comportementale
3. **Decoy hosts (-D) :** Masque la source réelle du scan
4. **Port source 53 :** Contourne certains firewalls

**Conclusion :** L'infrastructure présente une surface d'attaque modérée avec plusieurs services exposés nécessitant un durcissement. Les techniques d'évasion testées sont efficaces contre les défenses de base.

