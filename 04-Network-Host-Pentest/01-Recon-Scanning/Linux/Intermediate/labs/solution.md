# Solution - Linux Recon Intermediate Lab

## Étape 1 : Découverte multi-réseaux avec Masscan

```bash
# Découverte rapide avec Masscan (< 5 minutes)
sudo masscan -p1-1000 192.168.10.0/24,192.168.20.0/24,192.168.30.0/24 --rate=1000 --wait=2 -oG masscan_discovery.gnmap

# Analyse des résultats
grep "open" masscan_discovery.gnmap | awk '{print $2}' | sort -u > active_hosts.txt
grep "open" masscan_discovery.gnmap | awk '{print $4}' | sort | uniq -c | sort -nr | head -10 > top_ports.txt
```

**Résultats attendus :**
- 192.168.10.0/24 : 25 hôtes actifs (serveurs)
- 192.168.20.0/24 : 45 hôtes actifs (postes de travail)  
- 192.168.30.0/24 : 8 hôtes actifs (équipements réseau)

**Top 10 ports :** 22, 80, 443, 445, 3389, 135, 139, 53, 25, 110

## Étape 2 : Énumération avancée avec NSE

```bash
# Énumération SMB
nmap --script smb-enum-shares,smb-enum-users -p 445 192.168.10.0/24 -oA smb_enum

# Analyse des services web
nmap --script http-enum,http-headers,http-methods -p 80,443 192.168.10.0/24 -oA web_enum

# Énumération SNMP
sudo nmap -sU -p 161 --script snmp-sysdescr,snmp-processes 192.168.30.0/24 -oA snmp_enum

# Détection de vulnérabilités
nmap --script vuln -p 22,80,443,445 192.168.10.0/24 -oA vuln_scan
```

## Étape 3 : Analyse UDP et services cachés

```bash
# Découverte DNS
sudo nmap -sU -p 53 --script dns-service-discovery 192.168.10.0/24

# Services DHCP
sudo nmap -sU -p 67,68 --script dhcp-discover 192.168.30.0/24

# Ports non-standard
nmap -p 10000-65535 --top-ports 100 192.168.10.0/24

# Technique d'évasion personnalisée
sudo nmap -f -D RND:5 --source-port 53 --scan-delay $((RANDOM%10+5))s -p 80,443 192.168.10.0/24
```

**Vulnérabilités critiques identifiées :**
1. EternalBlue (MS17-010) sur 3 serveurs Windows
2. Apache Struts RCE sur 2 serveurs web
3. SNMP community strings par défaut sur équipements réseau
4. SSH avec authentification par mot de passe faible
5. Services FTP anonymes accessibles

